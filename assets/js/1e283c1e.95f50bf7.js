"use strict";(self.webpackChunkzonedstorage_io=self.webpackChunkzonedstorage_io||[]).push([[7727],{4047:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>l,frontMatter:()=>s,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"device-mapper/dm-crypt","title":"dm-crypt","description":"The dm-crypt target implements encryption and decryption of data written to","source":"@site/docs/device-mapper/dm-crypt.md","sourceDirName":"device-mapper","slug":"/device-mapper/dm-crypt","permalink":"/docs/device-mapper/dm-crypt","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"dm-crypt","title":"dm-crypt","sidebar_label":"dm-crypt"},"sidebar":"docs","previous":{"title":"dm-linear","permalink":"/docs/device-mapper/dm-linear"},"next":{"title":"dm-zoned","permalink":"/docs/device-mapper/dm-zoned"}}');var d=t(4848),i=t(8453);const s={id:"dm-crypt",title:"dm-crypt",sidebar_label:"dm-crypt"},c="dm-crypt",o={},a=[{value:"Zoned Block Device Restrictions",id:"zoned-block-device-restrictions",level:2},{value:"Example",id:"example",level:2}];function p(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"dm-crypt",children:"dm-crypt"})}),"\n",(0,d.jsxs)(n.p,{children:["The ",(0,d.jsx)(n.em,{children:"dm-crypt"})," target implements encryption and decryption of data written to\nand read from a block device, using the kernel crypto API."]}),"\n",(0,d.jsx)(n.h2,{id:"zoned-block-device-restrictions",children:"Zoned Block Device Restrictions"}),"\n",(0,d.jsxs)(n.p,{children:["The same zone alignment restrictions that apply to the\n",(0,d.jsx)(n.a,{href:"/docs/device-mapper/dm-linear",children:(0,d.jsx)(n.em,{children:"dm-linear"})})," target also apply to ",(0,d.jsx)(n.em,{children:"dm-crypt"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["In addition, when using a zoned block device, ",(0,d.jsx)(n.em,{children:"dm-crypt"})," can only be used with\nthe ",(0,d.jsx)(n.em,{children:"plain"})," mode. LUKS format is not supported. This means that the key used for\nencryption and decryption must be provided by the user when initializing the\n",(0,d.jsx)(n.em,{children:"dm-crypt"})," device. This key is not securely and permanently stored on the zoned\nblock device."]}),"\n",(0,d.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.em,{children:"dm-crypt"})," detailed documentation and usage examples can be found in the kernel\nsource code documentation file ",(0,d.jsx)("a",{href:"https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/device-mapper/dm-crypt.rst",target:"_blank",children:"Documentation/admin-guide/device-mapper/dm-crypt.rst"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["The script below shows a simple example for setting up ",(0,d.jsx)(n.em,{children:"dm-crypt"})," on top of an\nSMR hard-disk using the ",(0,d.jsx)(n.em,{children:"cryptsetup"})," utility. With this script, since the file\ncontaining the encryption key is stored unencrypted and will be lost if the\nsystem is rebooted, ",(0,d.jsx)(n.strong,{children:"this example should not be used in a production system"}),"."]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\nif [ $# != 1 ]; then\n        echo "Usage: $0 <device>"\n        exit 1\nfi\n\ndev="$(realpath "$1")"\ndname="$(basename "${dev}")"\nkeyfile="/tmp/dm-crypt-${dname}-keyfile"\n\n\nif [ ! -e ${keyfile} ]; then\n        # Generate a key file (4096-bits key)\n        dd if=/dev/random of="${keyfile}" bs=1 count=512 > /dev/null 2>&1\nfi\n\ncryptsetup open --type plain \\\n        --cipher null --key-size 512 --key-file "${keyfile}" \\\n        "${dev}" "crypt-${dname}"\n\nls -aFl /dev/mapper | grep crypt\n'})}),"\n",(0,d.jsx)(n.p,{children:"Running this scripts creates a device mapper zoned block device."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-plaintext",children:"# dm-crypt-setup.sh /dev/sdb\nlrwxrwxrwx.  1 root root       7 Jul  9 18:40 crypt-sdb -> ../dm-0\n\n# blkzone report /dev/dm-0\n  start: 0x000000000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000080000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000100000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000180000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n...\n  start: 0xda4680000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  start: 0xda4700000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  start: 0xda4780000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n"})})]})}function l(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var r=t(6540);const d={},i=r.createContext(d);function s(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);