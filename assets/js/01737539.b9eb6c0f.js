"use strict";(self.webpackChunkzonedstorage_io=self.webpackChunkzonedstorage_io||[]).push([[7500],{5548:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=t(7624),o=t(4552);const i={id:"util-linux",title:"Linux System Utilities",sidebar_label:"Linux System Utilities"},l="Linux System Utilities",a={id:"tools/util-linux",title:"Linux System Utilities",description:"util-linux is, as the documentation of the util-linux project itself says,",source:"@site/docs/tools/util-linux.md",sourceDirName:"tools",slug:"/tools/util-linux",permalink:"/docs/tools/util-linux",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"util-linux",title:"Linux System Utilities",sidebar_label:"Linux System Utilities"},sidebar:"docs",previous:{title:"Overview",permalink:"/docs/tools"},next:{title:"ZNS Tools",permalink:"/docs/tools/zns"}},r={},c=[{value:"lsblk",id:"lsblk",level:2},{value:"blkzone",id:"blkzone",level:2},{value:"Zone Report",id:"zone-report",level:3},{value:"Device capacity",id:"device-capacity",level:3},{value:"Zone Reset",id:"zone-reset",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.M)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"linux-system-utilities",children:"Linux System Utilities"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"util-linux"})," is, as the documentation of the ",(0,s.jsx)(n.em,{children:"util-linux"})," project itself says,\na random collection of Linux\xae utilities. The ",(0,s.jsx)(n.em,{children:"util-linux"})," project is\nhosted ",(0,s.jsx)("a",{href:"https://github.com/karelzak/util-linux",target:"_blank",children:"here on GitHub"}),"\nand ",(0,s.jsx)("a",{href:"https://github.com/util-linux/util-linux",target:"_blank",children:"here"}),".\nThis project is packaged in most distributions under the name ",(0,s.jsx)(n.em,{children:"util-linux"})," and\nis installed by default."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"util-linux"})," provides (among other utilities) the ",(0,s.jsx)(n.em,{children:"lsblk"})," and ",(0,s.jsx)(n.em,{children:"blkzone"}),"\ncommand-line tools, which are used to list zoned block devices and to obtain\nzone configurations. The ",(0,s.jsx)(n.em,{children:"blkzone"})," tool also allows the write pointer of\nsequential zones to be reset."]}),"\n",(0,s.jsx)(n.p,{children:"These utilities are especially useful for shell scripting and for\ntroubleshooting zone management problems in user applications."}),"\n",(0,s.jsx)(n.h2,{id:"lsblk",children:"lsblk"}),"\n",(0,s.jsxs)(n.p,{children:["The lsblk command lists all the block devices of a system, regardless of the\nblock device type (this means that yes, it also includes zoned block devices).\nThe output of ",(0,s.jsx)(n.em,{children:"lsblk"})," is as follows:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# lsblk\nNAME     MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT\nsda        8:0    0 167.7G  0 disk\n\u251c\u2500sda1     8:1    0     1G  0 part /boot\n\u251c\u2500sda2     8:2    0 150.7G  0 part /\n\u2514\u2500sda3     8:3    0    16G  0 part [SWAP]\nsdb        8:16   0  12.8T  0 disk\nsdc        8:32   0  12.8T  0 disk\nsdd        8:48   0  13.7T  0 disk\n"})}),"\n",(0,s.jsxs)(n.p,{children:["By default, ",(0,s.jsx)(n.em,{children:"lsblk"})," provides no indication of the zone model of the listed\nblock devices. To discover this information, use the option ",(0,s.jsx)(n.code,{children:"-z"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# lsblk -z\nNAME     ZONED\nsda      none\n\u251c\u2500sda1   none\n\u251c\u2500sda2   none\n\u2514\u2500sda3   none\nsdb      host-managed\nsdc      host-managed\nsdd      host-managed\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The output of ",(0,s.jsx)(n.em,{children:"lsblk"})," can be formatted by using the ",(0,s.jsx)(n.code,{children:"-o"})," option. For example,\nthe following command will display block device names, size, and zone model."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# lsblk -o NAME,SIZE,ZONED\nNAME       SIZE ZONED\nsda      167.7G none\n\u251c\u2500sda1       1G none\n\u251c\u2500sda2   150.7G none\n\u2514\u2500sda3      16G none\nsdb       12.8T host-managed\nsdc       12.8T host-managed\nsdd       13.7T host-managed\n"})}),"\n",(0,s.jsx)(n.h2,{id:"blkzone",children:"blkzone"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.em,{children:"blkzone"})," command line utility lists (reports) the zones of a zoned block\ndevice and resets the write pointer of sequential zones. Unlike the\n",(0,s.jsx)(n.em,{children:"sg_rep_zone"})," and ",(0,s.jsx)(n.em,{children:"sg_reset_wp"})," utilities of the\n",(0,s.jsx)(n.a,{href:"/docs/tools/sg3utils",children:(0,s.jsx)(n.em,{children:"sg3utils"})})," project, ",(0,s.jsx)(n.em,{children:"blkzone"})," relies on the kernel-\nprovided ZBD ",(0,s.jsx)(n.code,{children:"ioctl()"}),' interface to perform "zone report" and "zone reset"\noperations. ',(0,s.jsx)(n.em,{children:"blkzone"})," does not issue SCSI, ATA, or NVMe commands directly to\nthe device."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"blkzone"})," command usage is as shown below:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:'# blkzone --help\n\nUsage:\n blkzone <command> [options] <device>\n\nRun zone command on the given block device.\n\nCommands:\n report       Report zone information about the given device\n capacity     Report zone capacity for the given device\n reset        Reset a range of zones.\n open         Open a range of zones.\n close        Close a range of zones.\n finish       Set a range of zones to Full.\n\nOptions:\n -o, --offset <sector>  start sector of zone to act (in 512-byte sectors)\n -l, --length <sectors> maximum sectors to act (in 512-byte sectors)\n -c, --count <number>   maximum number of zones\n -f, --force            enforce on block devices used by the system\n -v, --verbose          display more details\n\n -h, --help             display this help\n -V, --version          display version\n\nArguments:\n <sector> and <sectors> arguments may be followed by the suffixes for\n   GiB, TiB, PiB, EiB, ZiB, and YiB (the "iB" is optional)\n\nFor more details see blkzone(8).\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:['The "open", "close" and "finish" commands of ',(0,s.jsx)(n.em,{children:"blkzone"})," are available in\n",(0,s.jsx)(n.em,{children:"util-linux"})," version 2.37 and later. The ",(0,s.jsx)(n.code,{children:"capacity"})," command is available on the\nmaster branch."]})}),"\n",(0,s.jsx)(n.h3,{id:"zone-report",children:"Zone Report"}),"\n",(0,s.jsx)(n.p,{children:"Use the following command to list the zones of a device:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# blkzone report /dev/sdd\n  start: 0x000000000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000080000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000100000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000180000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000200000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000280000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000300000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000380000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000400000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x000480000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  ...\n  start: 0x010500000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x010580000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 0(nw) [type: 1(CONVENTIONAL)]\n  start: 0x010600000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  start: 0x010680000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  start: 0x010700000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  start: 0x010780000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  start: 0x010800000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n  ...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To restrict the report to a range of zones, use the options ",(0,s.jsx)(n.code,{children:"--offset"})," and\n",(0,s.jsx)(n.code,{children:"--count"}),". For example, to report only the first sequential zone\nof a disk starting at sector 274726912, use the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# blkzone report --offset 274726912 --count 1 /dev/sdd\nstart: 0x010600000, len 0x080000, cap 0x080000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"device-capacity",children:"Device capacity"}),"\n",(0,s.jsxs)(n.p,{children:["If a zone's capacity is smaller than its size, the size listed in ",(0,s.jsx)(n.em,{children:"blockdev"})," and\n",(0,s.jsx)(n.em,{children:"lsblk"})," does not indicate how much data can be stored on on the zoned block\ndevice. The storage capacity of the device is the sum of the capacity of all\nzones."]}),"\n",(0,s.jsx)(n.p,{children:"Use the following command to determine the storage capcity of a device in\nsectors:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# blkzone capacity /dev/nullb1\n0x00c350000\n"})}),"\n",(0,s.jsx)(n.h3,{id:"zone-reset",children:"Zone Reset"}),"\n",(0,s.jsxs)(n.p,{children:["Sequential write zones can be reset with ",(0,s.jsx)(n.em,{children:"blkzone"})," by using the ",(0,s.jsx)(n.code,{children:"reset"}),"\noperation. For example, to reset the first sequential zone of a disk starting\nat sector 274726912, use the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# blkzone reset --offset 274726912 --count 1 /dev/sdd\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If the range of zones that is specified with the ",(0,s.jsx)(n.code,{children:"reset"})," operation includes\nconventional zones, the command will fail:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# blkzone reset /dev/sdd\nblkzone: /dev/sdh: BLKRESETZONE ioctl failed: Remote I/O error\n"})}),"\n",(0,s.jsx)(n.p,{children:"The user MUST exclude all conventional zones. In the example above, all\nconventional zones are located on the disk between sector 0 and 274726912.  The\nremainder of the disk is composed of sequential write zones. This means that\nthe following command will reset the write pointer in all zones:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"# blkzone reset --offset 274726912 /dev/sdd\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:['This command results in the kernel (1) looping over all of the disk\'s\nsequential zones and (2) executing a "zone reset" command on each zone. This\ncan be time-consuming and takes much longer than does using the\n',(0,s.jsx)(n.a,{href:"/docs/tools/sg3utils#sg_reset_wp",children:(0,s.jsx)(n.em,{children:"sg_reset_wp"})})," command with the ",(0,s.jsx)(n.code,{children:"--all"}),"\noption specified."]})})]})}function h(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},4552:(e,n,t)=>{t.d(n,{I:()=>a,M:()=>l});var s=t(1504);const o={},i=s.createContext(o);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);