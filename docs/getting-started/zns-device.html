<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/zns-device" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Getting Started with NVMe ZNS Devices | Zoned Storage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zonedstorage.io/docs/getting-started/zns-device"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Getting Started with NVMe ZNS Devices | Zoned Storage"><meta data-rh="true" name="description" content="Emulated NVMe ZNS devices make it possible to do application development and"><meta data-rh="true" property="og:description" content="Emulated NVMe ZNS devices make it possible to do application development and"><link data-rh="true" rel="icon" href="/img/zs-logo.ico"><link data-rh="true" rel="canonical" href="https://zonedstorage.io/docs/getting-started/zns-device"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/getting-started/zns-device" hreflang="en"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/getting-started/zns-device" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Getting Started with NVMe ZNS Devices","item":"https://zonedstorage.io/docs/getting-started/zns-device"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><link rel="stylesheet" href="/assets/css/styles.0fff285b.css">
<script src="/assets/js/runtime~main.92571c25.js" defer="defer"></script>
<script src="/assets/js/main.69b7e4e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Zoned Storage</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/introduction">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/getting-started">Getting Started</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/linux">Setting-up a Zoned Storage Compatible Linux System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/zbd-emulation">Getting Started with Emulated Zoned Block Devices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/smr-disk">Getting Started with SMR Hard Disks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/zns-device">Getting Started with NVMe ZNS Devices</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux">Linux Kernel Support</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/device-mapper">Device Mapper</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/filesystems">File Systems</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/applications">Applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tools">Tools and Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tests">System Compliance Tests</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/benchmarking">Performance Benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/distributions/overview">Linux Distributions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Getting Started with NVMe ZNS Devices</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Getting Started with NVMe ZNS Devices</h1></header>
<p>Emulated NVMe ZNS devices make it possible to do application development and
kernel tests without physical NVMe ZNS devices. There are two ways to emulate
NVMe ZNS devices.</p>
<ul>
<li>
<p><em><strong>null_blk</strong></em>: The null_blk kernel driver can emulate zoned block
devices with a zone configuration that is compatible with real NVMe ZNS
devices. This method is discussed in more detail in the
<a href="/docs/getting-started/zbd-emulation">Zoned Block Device Emulation with
null_blk</a> chapter of the Getting Started
Guide.</p>
</li>
<li>
<p><em><strong>QEMU</strong></em>: This open-source machine emulator and virtualizer can
create emulated NVMe devices that use regular files on the host as a
backstore. Recent versions of QEMU support the emulation of Zoned
Namespaces.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="qemu"><em>QEMU</em><a href="#qemu" class="hash-link" aria-label="Direct link to qemu" title="Direct link to qemu">​</a></h2>
<p><em><a href="https://www.qemu.org/" target="_blank">QEMU</a></em> has supported the
emulation of NVMe namespaces since QEMU version 1.6, but the emulation of zoned
namespaces has been supported only since QEMU version 6.0. If the host
Linux distribution does not provide <em>QEMU</em> version 6.0 or above, <em>QEMU</em> has
to be compiled from source. Detailed information on how to compile and install
<em>QEMU</em> from source can be found <a href="https://www.qemu.org/download/#source" target="_blank">on the QEMU download page</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-emulated-zoned-namespace">Creating an Emulated Zoned Namespace<a href="#creating-an-emulated-zoned-namespace" class="hash-link" aria-label="Direct link to Creating an Emulated Zoned Namespace" title="Direct link to Creating an Emulated Zoned Namespace">​</a></h3>
<p>To create an emulated zoned namespace, you must first have a backstore file
that the namespace can use. The size of the file determines the capacity of the
namespace that will be seen from the guest OS running in the <em>QEMU</em> virtual
machine.</p>
<p>For example: to create a 32GiB zoned namespace, you must first create a 32 GiB
file on the host. This can be done by using the <em>truncate</em> command to
create a sparse file or by using the <em>dd</em> command to create a fully allocated
file.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-backstore">Creating the Backstore<a href="#creating-the-backstore" class="hash-link" aria-label="Direct link to Creating the Backstore" title="Direct link to Creating the Backstore">​</a></h4>
<p>This guide provides instructions for two methods of creating the backstore file:</p>
<ol>
<li>Using truncate</li>
<li>Using dd</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="using-truncate-to-create-an-emulated-zone-namespace-backstore">Using truncate to create an Emulated Zone Namespace Backstore<a href="#using-truncate-to-create-an-emulated-zone-namespace-backstore" class="hash-link" aria-label="Direct link to Using truncate to create an Emulated Zone Namespace Backstore" title="Direct link to Using truncate to create an Emulated Zone Namespace Backstore">​</a></h5>
<p>Run the following command to use <code>truncate</code> to create a backstore file:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># truncate -s 32G /var/lib/qemu/images/zns.raw</span><br></span></code></pre></div></div>
<p>Verify that the backstore file was created:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ls -l /var/lib/qemu/images/zns.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 root root 34359738368 Jun 21 15:13 /var/lib/qemu/images/zns.raw</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="using-dd-to-create-an-emulated-zone-namespace-backstore">Using dd to create an Emulated Zone Namespace Backstore<a href="#using-dd-to-create-an-emulated-zone-namespace-backstore" class="hash-link" aria-label="Direct link to Using dd to create an Emulated Zone Namespace Backstore" title="Direct link to Using dd to create an Emulated Zone Namespace Backstore">​</a></h5>
<p>Run the following command to use <code>dd</code> to create a backstore file:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># dd if=/dev/zero of=/var/lib/qemu/images/zns.raw bs=1M count=32768</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32768+0 records in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32768+0 records out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">34359738368 bytes (34 GB, 32 GiB) copied, 11.4072 s, 3.0 GB/s</span><br></span></code></pre></div></div>
<p>Verify that the backstore file was created:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ls -l /var/lib/qemu/images/zns.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 root root 34359738368 Jun 22 11:22 /var/lib/qemu/images/zns.raw</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-zns-and-using-the-backstore-file">Creating a ZNS and using the Backstore File<a href="#creating-a-zns-and-using-the-backstore-file" class="hash-link" aria-label="Direct link to Creating a ZNS and using the Backstore File" title="Direct link to Creating a ZNS and using the Backstore File">​</a></h4>
<p>Run <em>QEMU</em> with command-line options and arguments to create a zoned
namespace that uses the backstore file as storage. In the following example,
we use the backstore file to emulate a zoned namespace that has zones of 64
MiB and a zone capacity of 62 MiB. The namespace block size is 4096 B. The
namespace is set to allow at most 16 open zones and 32 active zones.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># /usr/local/bin/qemu-system-x86_64 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device nvme,id=nvme0,serial=deadbeef,zoned.zasl=5 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-drive file=${znsimg},id=nvmezns0,format=raw,if=none \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device nvme-ns,drive=nvmezns0,bus=nvme0,nsid=1,logical_block_size=4096,\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">physical_block_size=4096,zoned=true,zoned.zone_size=64M,zoned.\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zone_capacity=62M,zoned.max_open=16,zoned.max_active=32,\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uuid=5e40ec5f-eeb6-4317-bc5e-c919796a5f79</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-an-emulated-zoned-namespace">Verifying an Emulated Zoned Namespace<a href="#verifying-an-emulated-zoned-namespace" class="hash-link" aria-label="Direct link to Verifying an Emulated Zoned Namespace" title="Direct link to Verifying an Emulated Zoned Namespace">​</a></h3>
<p>If your guest operating system is a Linux distribution and the Linux
distribution&#x27;s kernel version is higher than 5.9.0, the emulated NVMe ZNS
device can be checked using the <em>nvme</em> command (see <a href="/docs/tools/zns">Linux Tools for
ZNS</a>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># nvme list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node             SN                   Model                                    Namespace Usage                      Format           FW Rev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------------- -------------------- ---------------------------------------- --------- -------------------------- ---------------- --------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/nvme0n1     deadbeef             QEMU NVMe Ctrl                           1          34.36  GB /  34.36  GB      4 KiB +  0 B   1.0</span><br></span></code></pre></div></div>
<p>The <em>lsscsi</em> utility shows the emulated NVMe device:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2:0:0:0]    cd/dvd  QEMU     QEMU DVD-ROM     2.5+  /dev/sr0   /dev/sg0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[N:0:0:1]    disk    QEMU NVMe Ctrl__1                          /dev/nvme0n1  -</span><br></span></code></pre></div></div>
<p>Using the <em>blkzone</em> utility, the namespace zone configuration can be inspected.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># blkzone report /dev/nvme0n1 | less</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000000000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000020000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000040000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000060000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x000080000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x003f80000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x003fa0000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x003fc0000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  start: 0x003fe0000, len 0x020000, cap 0x01f000, wptr 0x000000 reset:0 non-seq:0, zcond: 1(em) [type: 2(SEQ_WRITE_REQUIRED)]</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The total number of zones of the namespace depends on the size of the backstore
file used and on the zone size that you configured. In the above example, the
emulated namespace has 512 zones (32 GiB / 64 MiB).</p></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/block/nvme0n1/queue/nr_zones </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">512</span><br></span></code></pre></div></div>
<p>If the emulated namespace is configured with a zone capacity that is smaller
than the zone size, the total capacity defined by the backstore file will not
be usable. The effective usable capacity can be reported using <em>blkzone</em> with
the <em>capacity</em> command, as shown here:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># blkzone capacity /dev/nvme0n1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0x003e00000</span><br></span></code></pre></div></div>
<p>In this case, the namespace&#x27;s effective storage capacity is 0x003e00000
(65011712) 512-Byte sectors, which is equivalent to 512 zones of 62 MiB
capacity.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-an-emulated-zoned-namespace">Using an Emulated Zoned Namespace<a href="#using-an-emulated-zoned-namespace" class="hash-link" aria-label="Direct link to Using an Emulated Zoned Namespace" title="Direct link to Using an Emulated Zoned Namespace">​</a></h3>
<p>The behavior of <em>QEMU</em>-emulated NVMe ZNS devices is fully compliant with the
NVMe ZNS specifications, with one exception: the state of namespace zones does
not persist across restarts of the <em>QEMU</em> emulator. The state of zones is
preserved only as long as <em>QEMU</em> is running, even if the guest operating system
is rebooted. If <em>QEMU</em> is restarted and the same backstore file is used, then
the guest operating system will see the namespace, but all of its zones will be
in the empty state.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="emulated-zoned-namespace-options">Emulated Zoned Namespace Options<a href="#emulated-zoned-namespace-options" class="hash-link" aria-label="Direct link to Emulated Zoned Namespace Options" title="Direct link to Emulated Zoned Namespace Options">​</a></h3>
<p>The implementation of NVMe device emulation and ZNS namespace emulation in
<em>QEMU</em> offers several configuration options that can be used to control the
characteristics of the device. The full list of options and parameters is
documented in the <a href="https://qemu-project.gitlab.io/qemu/system/nvme.html" target="_blank">QEMU project&#x27;s gitlab repository</a>.</p>
<p>The options and parameters related to Zoned Namespaces are as follows:</p>
<center><table><thead><tr><th style="text-align:left">Option</th><th style="text-align:left">Default Value</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">zoned.zasl=UINT32</td><td style="text-align:left">0</td><td style="text-align:left">Zone Append Size Limit. If left at the default (0), the zone append size limit will be equal to the maximum data transfer size (MDTS). Otherwise, the zone append size limit is equal to 2 to the power of zasl multiplied by the minimum memory page size (4096 B), but cannot exceed the maximum data transfer size.</td></tr><tr><td style="text-align:left">zoned.zone_size=<em>SIZE</em></td><td style="text-align:left">128MiB</td><td style="text-align:left">Define the zone size (ZSZE)</td></tr><tr><td style="text-align:left">zoned.zone_capacity=<em>SIZE</em></td><td style="text-align:left">0</td><td style="text-align:left">Define the zone capacity (ZCAP). If left at the default (0), the zone capacity will equal the zone size.</td></tr><tr><td style="text-align:left">zoned.descr_ext_size=<em>UINT32</em></td><td style="text-align:left">0</td><td style="text-align:left">Set the Zone Descriptor Extension Size (ZDES). Must be a multiple of 64 bytes.</td></tr><tr><td style="text-align:left">zoned.cross_read=<em>BOOL</em></td><td style="text-align:left">off</td><td style="text-align:left">Set to &quot;on&quot; to allow reads to cross zone boundaries.</td></tr><tr><td style="text-align:left">zoned.max_active=<em>UINT32</em></td><td style="text-align:left">0</td><td style="text-align:left">Set the maximum number of active resources (MAR). The default (0) allows all zones to be active.</td></tr><tr><td style="text-align:left">zoned.max_open=<em>UINT32</em></td><td style="text-align:left">0</td><td style="text-align:left">Set the maximum number of open resources (MOR).  The default (0) allows all zones to be open. If <code>zoned.max_active</code> is specified, this value must be less than or equal to that.</td></tr></tbody></table></center>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="qemu-execution-example"><em>QEMU</em> Execution Example<a href="#qemu-execution-example" class="hash-link" aria-label="Direct link to qemu-execution-example" title="Direct link to qemu-execution-example">​</a></h2>
<p>The following script uses <em>QEMU</em> to run a virtual machine that has 8 CPU cores,
16 GiB of memory, and bridged networking. The bridge device <em>virbr0</em> is assumed
already to exist. The last device added to the virtual machine on the <em>QEMU</em>
command line is a 32 GiB NVMe ZNS device.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Some variables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bridge=&quot;virbr0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vmimg=&quot;/var/lib/qemu/boot-disk.qcow2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">znsimg=&quot;/var/lib/qemu/zns.raw&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run QEMU</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo /usr/local/bin/qemu-system-x86_64 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-name guest=FedoraServer34 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-machine pc-q35-5.2,accel=kvm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-m 16384 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-smp 8,sockets=8,cores=1,threads=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rtc base=utc,driftfix=slew \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-nographic \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-no-hpet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-global ICH9-LPC.disable_s3=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-global ICH9-LPC.disable_s4=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-boot strict=on \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-audiodev none,id=noaudio \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-object rng-random,id=objrng0,filename=/dev/urandom \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-msg timestamp=on \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device pcie-root-port,port=0x10,chassis=1,id=pci.1,bus=pcie.0,multifunction=on,addr=0x2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-netdev bridge,id=hostnet0,br=${bridge} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:fa:2d:b9,bus=pci.1,addr=0x0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device pcie-root-port,port=0x11,chassis=2,id=pci.2,bus=pcie.0,addr=0x2.0x1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-blockdev node-name=&quot;vmstorage&quot;,driver=qcow2,file.driver=file,file.filename=&quot;${vmimg}&quot;,file.node-name=&quot;vmstorage.qcow2&quot;,file.discard=unmap \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device virtio-blk-pci,bus=pci.2,addr=0x0,drive=&quot;vmstorage&quot;,id=virtio-disk0,bootindex=1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device pcie-root-port,port=0x12,chassis=3,id=pci.3,bus=pcie.0,addr=0x2.0x2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device virtio-balloon-pci,id=balloon0,bus=pci.3,addr=0x0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device pcie-root-port,port=0x13,chassis=4,id=pci.4,bus=pcie.0,addr=0x2.0x3 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device virtio-rng-pci,rng=objrng0,id=rng0,bus=pci.4,addr=0x0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device pcie-root-port,port=0x14,chassis=5,id=pci.5,bus=pcie.0,addr=0x2.0x4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device nvme,id=nvme0,serial=deadbeef,zoned.zasl=5,bus=pci.5 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-drive file=${znsimg},id=nvmezns0,format=raw,if=none \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-device nvme-ns,drive=nvmezns0,bus=nvme0,nsid=1,logical_block_size=4096,physical_block_size=4096,zoned=true,zoned.zone_size=64M,zoned.zone_capacity=62M,zoned.max_open=16,zoned.max_active=32,uuid=5e40ec5f-eeb6-4317-bc5e-c919796a5f79</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/smr-disk"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Getting Started with SMR Hard Disks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#qemu" class="table-of-contents__link toc-highlight"><em>QEMU</em></a><ul><li><a href="#creating-an-emulated-zoned-namespace" class="table-of-contents__link toc-highlight">Creating an Emulated Zoned Namespace</a></li><li><a href="#verifying-an-emulated-zoned-namespace" class="table-of-contents__link toc-highlight">Verifying an Emulated Zoned Namespace</a></li><li><a href="#using-an-emulated-zoned-namespace" class="table-of-contents__link toc-highlight">Using an Emulated Zoned Namespace</a></li><li><a href="#emulated-zoned-namespace-options" class="table-of-contents__link toc-highlight">Emulated Zoned Namespace Options</a></li></ul></li><li><a href="#qemu-execution-example" class="table-of-contents__link toc-highlight"><em>QEMU</em> Execution Example</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started with Zoned Storage</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
</body>
</html>