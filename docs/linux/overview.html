<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-linux/overview" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Linux Kernel Zoned Storage Support | Zoned Storage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zonedstorage.io/docs/linux/overview"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Linux Kernel Zoned Storage Support | Zoned Storage"><meta data-rh="true" name="description" content="Zoned block device support was added to the Linux&amp;reg; kernel in version 4.10."><meta data-rh="true" property="og:description" content="Zoned block device support was added to the Linux&amp;reg; kernel in version 4.10."><link data-rh="true" rel="icon" href="/img/zs-logo.ico"><link data-rh="true" rel="canonical" href="https://zonedstorage.io/docs/linux/overview"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/linux/overview" hreflang="en"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/linux/overview" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Linux Kernel Zoned Storage Support","item":"https://zonedstorage.io/docs/linux/overview"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><link rel="stylesheet" href="/assets/css/styles.0fff285b.css">
<script src="/assets/js/runtime~main.6ff41505.js" defer="defer"></script>
<script src="/assets/js/main.69b7e4e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Zoned Storage</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/introduction">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/getting-started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/linux">Linux Kernel Support</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/linux/overview">Linux Kernel Zoned Storage Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/config">Kernel Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/zbd-api">Zoned Block Device User Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/sched">Write Ordering Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/linux/part">Zoned Block Device Partition Support</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/device-mapper">Device Mapper</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/filesystems">File Systems</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/applications">Applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tools">Tools and Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tests">System Compliance Tests</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/benchmarking">Performance Benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/distributions/overview">Linux Distributions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Linux Kernel Support</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Linux Kernel Zoned Storage Support</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Linux Zoned Storage Support Overview</h1></header>
<p>Zoned block device support was added to the Linux® kernel in version 4.10.
Subsequent versions improved this support and added new features beyond the raw
block device access interface. More advanced features such as device mapper
support and ZBD-aware file systems are now available.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Application developers can use zoned block devices by means of various I/O
paths, can control them with different programming interfaces, and can expose
zoned block devices in different ways. A simplistic representation of the
various access paths is shown in the figure below.</p>
<div class="container text--center"><figure><img src="/assets/images/linux-iopath-3ad49009873f1211b8e873f9ba540a38.png" width="640" max-width="100%"><figcaption><em>Linux Zoned block device support overview</em></figcaption></figure></div>
<p>Three different I/O paths implement two POSIX compatible interfaces that hide
the write constraints of the sequential zones of the zoned block devices. These
three I/O paths can run legacy applications (applications that have
not been modified to implement fully-sequential write streams).</p>
<ul>
<li>
<p><strong>File Access Interface</strong> This is the interface that file systems implement
to allow applications to organize their data into files and directories. Two
different implementations of the file access interface are available:</p>
<ul>
<li>
<p><strong>ZBD Compliant File System</strong>: With this implementation, the file system
is modified to directly handle the sequential write constraint of zoned
block devices. Random writes to files by applications are transformed
into sequential write streams by the file system, concealing the device
constraints from the application. An example of this is the
<a href="/docs/filesystems/f2fs"><em>F2FS</em></a> file system.</p>
</li>
<li>
<p><strong>Legacy File System</strong>: With this implementation, an unmodified file
system is used and the device-sequential write constraint is handled by a
device mapper target driver that exposes the zoned block device as a
regular block device. This device mapper is called <em>dm-zoned</em>. Its
characteristics are discussed in detail
<a href="/docs/device-mapper/dm-zoned">here</a>.</p>
</li>
</ul>
</li>
<li>
<p><strong>Raw Block Access Interface</strong> This is the raw block device file access
interface that can be used by applications to directly access data stored on
the device. Similar to the legacy file system case, this interface is
implemented using the <a href="/docs/device-mapper/dm-zoned"><em>dm-zoned</em></a> device mapper
target driver to hide the sequential write constraints from the application.</p>
</li>
</ul>
<p>Three additional interfaces are available to applications that have been
written or modified to comply with the sequential write constraint of zoned
block devices. These interfaces directly expose the device constraints to
applications which must ensure that data is written using sequential streams
that start from the write-pointer positions of the zones.</p>
<ul>
<li>
<p><strong>File Access Interface</strong>: This special interface is implemented by the
<a href="/docs/filesystems/zonefs"><em>zonefs</em></a> file system. <em>zonefs</em> is a very simple file
system that exposes each zone of a zoned block device as a file. But unlike
regular POSIX file systems, the sequential write constraint of the device is
not automatically handled by zonefs. It is the responsibility of the
application to sequentially write files that represent zones.</p>
</li>
<li>
<p><strong>Zoned Raw Block Access Interface</strong>: This is the counterpart of the <em>Raw
Block Access Interface</em> (without any intermediate driver to handle the device
constraints). An application can use this interface by directly opening the
device file that represents the zoned block device to gain access to zone
information and management operations that are provided by the block layer.
<a href="/docs/tools/util-linux"><em>Linux System Utilities</em></a>, for example, use this
interface. Physical zoned block devices, as well as logically-created zoned
block devices (e.g. zoned block devices created with the
<a href="/docs/device-mapper/dm-linear"><em>dm-linear</em></a> device mapper target), support
this interface. The <a href="/docs/tools/libzbd"><em>libzbd</em></a> user library and tools can
simplify the implementation of applications that use this interface.</p>
</li>
<li>
<p><strong>Passthrough Device Access Interface</strong> This is the interface (provided by
the SCSI generic driver (SG) and the NVMe driver) that allows an application
to send SCSI or NVMe commands directly to a device. The kernel interferes
minimally with the commands sent by applications, resulting in the need for
an application that can handle all device constraints itself (e.g. Logical
and physical sector size, zone boundaries, command timeout, command retry
count, etc). User-level libraries such as <a href="/docs/tools/libzbc"><em>libzbc</em></a>
and <a href="/docs/tools/libnvme"><em>libnvme</em></a> can greatly simplify the
implementation of applications that use this interface.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kernel-versions">Kernel Versions<a href="#kernel-versions" class="hash-link" aria-label="Direct link to Kernel Versions" title="Direct link to Kernel Versions">​</a></h2>
<p>The initial release of the zoned block device support with kernel 4.10 was
limited to the block layer ZBD user interface, SCSI layer sequential write
ordering control and native support for the <em>F2FS</em> file system. Following
kernel versions added more feature such as device mapper drivers and support
for the block multi-queue infrastructure.</p>
<p>The figure below summarizes the evolution of zoned block device support with
kernel versions.</p>
<div class="container text--center"><figure><img src="/assets/images/linux-versions-eaa94336f891a8e3f184b3018b02be70.png" width="640" max-width="100%"><figcaption><em>Kernel versions and supported features</em></figcaption></figure></div>
<ul>
<li>
<p><strong>Passthrough Access Support (<em>SG Access</em>)</strong> Support for exposing host managed
ZBC/ZAC hard-disks as SCSI generic (SG) nodes was officially added to kernel
3.18 with the definition of the device type <code>TYPE_SCSI</code> for SCSI devices and
with the definition of the device class <code>ATA_DEV_ZAC</code> for ATA devices. For
kernels older than version 3.18, SATA host managed ZAC disks will not be
exposed to the users as SG nodes nor as block device files. These older
kernels will simply ignore SATA devices reporting a host managed ZAC device
signature and the devices will not be usable in any way. For SCSI disks or
SATA disks connected to a compatible SAS HBA, host managed disk will be
accessible by the user through the node file created by the SG driver to
represent these disks.</p>
</li>
<li>
<p><strong>Zoned Block Device Access and <em>F2FS</em> Support</strong> The block I/O layer zoned
block device support added to kernel version 4.10 enables exposing
host managed ZBC and ZAC disks as block device files, similarly to regular
disks. This support also includes changes to the kernel <em>libata</em> command
translation to enable SCSI ZBC zone block commands translation to ZAC zone ATA
commands. For applications relying on SCSI generic direct access, this enables
handling both ZBC (SCSI) and ZAC (ATA) disks with the same code (e.g. ATA
commands do not need to be issued). Access to zoned block devices is also
possible using the disk block device file (e.g. <em>/dev/sdX</em> device file) with
regular POSIX system calls. However, compared to regular disks, some
restrictions still apply
(see <a href="#zbd-support-restrictions">Kernel ZBD Support Restrictions</a>).</p>
</li>
<li>
<p><strong>Device Mapper and <em>dm-zoned</em> Support</strong> With kernel version 4.13.0, support
for zoned block devices was added to the device mapper infrastructure. This
support allows using the <em>dm-linear</em> and <em>dm-flakey</em> device mapper targets on
top of zoned block devices. Additionally, the <em>dm-zoned</em> device mapper
target driver was also added.</p>
</li>
<li>
<p><strong>Block multi-queue and SCSI multi-queue Support</strong> With kernel
version 4.16.0, support for the block multi-queue infrastructure was added.
This improvement enables using host managed ZBC and ZAC disks with the SCSI
multiqueue (<em>scsi-mq</em>) support enabled while retaining support for the legacy
single queue block I/O path. The block multi queue and <em>scsi-mq</em> I/O path are
the default since kernel version 5.0 with the removal of the legacy single
queue block I/O path support.</p>
</li>
<li>
<p><strong>zonefs</strong> Kernel 5.6.0 first introduced the <em>zonefs</em> file system which
exposes zones of a zoned block device as regular files. <em>zonefs</em> being
implemented using the kernel internal zoned block device interface, all types
of zoned block devices are supported (SCSI ZBC, ATA ZAC and NVMe ZNS).</p>
</li>
<li>
<p><strong>Zone Append Operation Support</strong> Kernel version 5.8.0 introduced a generic
block layer interface for supporting
<a href="/docs/introduction/zns#zone-append">zone append write operations</a>. This
release also modifies the SCSI layer to emulate these operations using regular
write commands. With the introduction of NVMe ZNS support (see below), this
emulation unifies the interface and capabilities of all zoned block devices,
simplifying the implementation of other features such as file systems.</p>
</li>
<li>
<p><strong>NVM Express Zoned Namespaces</strong> With kernel version 5.9, support for the
NVMe ZNS command set was added. This enables the nvme driver with the command
set enhancements required to discover zoned namespaces, and registers these
with the block layer as host managed zone block devices. This kernel release
only support devices that do <em>not</em> implement any of the zone optional
characteristics (ZOC), and also requires that the device implements the
optional Zone Append command.</p>
</li>
<li>
<p><strong>BTRFS Support</strong> Support for the <a href="/docs/filesystems/btrfs">BTRFS file system</a>
was added in kernel version 5.12. This POSIX compliant general purpose
file system completely hides the sequential write constraint of zoned block
devices to users, and thus allows the execution of unmodified applications
using files to manage data.</p>
</li>
<li>
<p><strong>Zone Write Plugging</strong> Kernel version 6.10 introduced an improved write
ordering control for zoned block devices. This is implemented as a generic
feature of the block layer. <a href="/docs/linux/sched#zone-write-plugging">Zone Write
Plugging</a> replaces the older write
ordering <a href="/docs/linux/sched#zone-write-locking">Zone Write Locking</a> mechanism
implemented within the <em>mq-deadline</em> block I/O scheduler.</p>
</li>
<li>
<p><strong>XFS Support</strong> With kernel 6.15, the <a href="/docs/filesystems/xfs"><em>XFS</em> file
system</a> gained native zoned block device support.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="recommended-kernel-versions">Recommended Kernel Versions<a href="#recommended-kernel-versions" class="hash-link" aria-label="Direct link to Recommended Kernel Versions" title="Direct link to Recommended Kernel Versions">​</a></h2>
<p>All kernel versions since 4.10 include zoned block device support. However, as
shown in the figure <a href="#kernel-versions">Kernel versions and features</a>, some
versions are recommended over others.</p>
<ul>
<li>
<p><strong>Long Term Stable (LTS) Versions</strong> Kernel versions 5.4, 5.10, 5.15 6.1, 6.6,
and 6.12 are long term stable kernel versions that include bug fixes
backported from fixes in the mainline (development) kernel. These versions
benefit from stability improvements that were developed for higher versions.
Fixes to the zoned-block-device support infrastructure are also backported to
these versions.</p>
</li>
<li>
<p><strong>Latest Stable Version</strong> While not necessarily marked as a long-term stable
version, the latest stable kernel version receives all bug fixes developed in
the main line of kernel development. Except if the version is tagged as a
long term support version, back-port of fixes to a stable kernel version
stops with the switch of the following version from mainline to stable. Using
a particular kernel stable version for a long time is thus not recommended.</p>
</li>
</ul>
<p>For any stable or long term stable kernel version, we recommend that system
administrators use the latest available release within that version to ensure
that all known fixes are applied.</p>
<p>The list of current mainline, stable and long term stable kernel versions can
be found on <a href="https://www.kernel.org/" target="_blank">
The Linux Kernel Archives</a> site.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="zbd-support-restrictions">ZBD Support Restrictions<a href="#zbd-support-restrictions" class="hash-link" aria-label="Direct link to ZBD Support Restrictions" title="Direct link to ZBD Support Restrictions">​</a></h2>
<p>In order to keep changes to the block layer code to a mimimum, various existing
features of the block layer were reused (for instance, automatic splitting of
IOs on LBA boundaries implemented for software RAID is one example of this
reuse). Kernel components that are not compatible with the behavior of zoned
block devices or were too complex to change were left unmodified. This resulted
in a set of constraints that constrain all zoned block devices that work with
Linux.</p>
<ul>
<li>
<p><strong>Zone size</strong> ZBC, ZAC, and ZNS standards do not impose any constraints on
the zone layout of a device (this means that zones can be of any size), but
kernel ZBD support is restricted to zoned devices on which all zones are of
equal size. The zone size must also be equal to a number of logical blocks
that is a power of 2. Only the last zone of a device may have a smaller size
(a so called <em>runt</em> zone). This zone-size restriction allows the kernel code
to use the block layer &quot;chunked&quot; space management that is normally used for
software RAID devices. The chunked space management uses power-of-two
arithmetic (bit shift operations) to determine which chunk (i.e. which zone)
is being accessed and it also ensures that block I/O operations do not cross
zone boundaries.</p>
</li>
<li>
<p><strong>Unrestricted Reads</strong> The ZBC and ZAC standards define the <em>URSWRZ</em> bit,
which determines whether a device will return an error when a read operation
is directed at unwritten sectors of a sequential write required zone. (An
example of this kind of read operation is when a read command accesses
sectors that are after the write-pointer position of a zone.) Linux supports
only ZBC and ZAC host-managed hard disks that allow unrestricted read
commands. In other words, Linux supports only SMR hard disks that report that
the <em>URSWRZ</em> bit is not set. This restriction has been added to ensure that
the block-layer disk-partition-scanning process does not result in read
commands that fail whenever the disk partition table is checked.</p>
</li>
<li>
<p><strong>Direct IO Writes</strong> The kernel page cache does not guarantee that cached
dirty pages will be flushed to a block device in sequential sector order.
This can lead to unaligned write errors if an application uses buffered
writes to write to the sequential write required zones of a device. To avoid
this pitfall, applications that directly use a zoned block device without a
file system should always use direct I/O operations to write to the
sequential write required zones of a host-managed disk  (that is, they should
issue <code>write()</code> system calls with a block device &quot;file open&quot; that uses the
<code>O_DIRECT</code> flag).</p>
</li>
<li>
<p><strong>Zone Append</strong> The ZNS specifications define the optional &quot;Zone Append&quot;
command. This command can be used instead of regular write commands when the
host must write data, but requires the device to report where the data was
placed. This allows an efficient host implementation, because (1) the write
pointer does not have to be tracked and (2) write commands do not have to be
ordered.  The Linux IO stack has been enabled to use this with kernel version
5.8 and the NVMe driver requires the device to support this optional command
in order for the namespace to be usable through the kernel.</p>
</li>
</ul>
<p>All known ZBC and ZAC host-managed hard disks that are available on the market
today have characteristics compatible with these requirements and can operate
with a ZBD-compatible Linux kernel.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/linux"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux/config"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kernel Configuration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#kernel-versions" class="table-of-contents__link toc-highlight">Kernel Versions</a></li><li><a href="#recommended-kernel-versions" class="table-of-contents__link toc-highlight">Recommended Kernel Versions</a></li><li><a href="#zbd-support-restrictions" class="table-of-contents__link toc-highlight">ZBD Support Restrictions</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started with Zoned Storage</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
</body>
</html>