<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-benchmarking/fio/zns-fio">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><title data-rh="true">fio Examples for NVMe ZNS Devices | Zoned Storage</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zonedstorage.io/docs/benchmarking/fio/zns-fio"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="fio Examples for NVMe ZNS Devices | Zoned Storage"><meta data-rh="true" name="description" content="To avoid additional overhead, the mq-deadline scheduler may be disabled for the"><meta data-rh="true" property="og:description" content="To avoid additional overhead, the mq-deadline scheduler may be disabled for the"><link data-rh="true" rel="icon" href="/img/zs-logo.ico"><link data-rh="true" rel="canonical" href="https://zonedstorage.io/docs/benchmarking/fio/zns-fio"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/benchmarking/fio/zns-fio" hreflang="en"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/benchmarking/fio/zns-fio" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.028cc568.css">
<link rel="preload" href="/assets/js/runtime~main.acbffe4f.js" as="script">
<link rel="preload" href="/assets/js/main.f78c3487.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Zoned Storage</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/getting-started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/linux">Linux Kernel Support</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/applications">Applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tools">Tools and Libraries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tests">System Compliance Tests</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/benchmarking">Performance Benchmarking</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/benchmarking">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/benchmarking/fio/overview">fio</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/benchmarking/fio/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/benchmarking/fio/smr-fio">Examples for SMR hard-disks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/benchmarking/fio/zns-fio">Examples for NVMe ZNS Devices</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/benchmarking/rocksdb">RocksDB - ZenFS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/benchmarking/myrocks">MyRocks - ZenFS</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/distributions/linux">Linux Distributions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Performance Benchmarking</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">fio</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Examples for NVMe ZNS Devices</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>fio Examples for NVMe ZNS Devices</h1></header><p>To avoid additional overhead, the <em>mq-deadline</em> scheduler may be disabled for the
following <em>fio</em> examples.
This is possible because the write workload uses the <em>psync</em> ioengine, which
synchronizes the write commands. In addition each write job operates on a
different sets of zones. Therefore, <em>mq-deadline</em> can be avoided, and the zone
write pointers are still advanced in order to comply with the sequential write
constraint.</p><p>For read workloads the sequential write constraint is not violated and reads can
be issued out of order without <em>mq-deadline</em> being enabled.</p><p><em>fio</em> runs that enable <em>psync</em>, can emulate a <em>iodepth</em> like behavior by using the
<em>numjobs</em> parameter in combination with <code>offset_increment == size</code>. This results
in <em>numjobs</em> asynchronous operations that use a dedicated set of zones, which
demonstrates the parallel performance potential.</p><p>Since ZNS devices have a sequential write constraint, only sequential writes are
benchmarked. Benchmarking random writes with <em>fio</em> is not trivial because the
writes will eventually end up being sequentially written to the ZNS device,
therefore the results will be influenced by <em>fio</em>&#x27;s scheduling.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Before issuing writes on a ZNS drive the zones should be reset by calling:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># blkzone reset /dev/nvmeXnX</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sequential-writes">Sequential writes<a class="hash-link" href="#sequential-writes" title="Direct link to heading">​</a></h2><p>Assuming that the drive to be benchmarked has <code>max_open_zones=14</code> and more than
112 zones (<code>= offset_increment * max(numjobs)</code>), a write workload may be issued
like the following example shows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># fio --ioengine=psync --direct=1 --filename=/dev/nvmeXnX --rw=write \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --bs=64k --group_reporting --zonemode=zbd --name=seqwrite \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --offset_increment=8z --size=8z --numjobs=14 --job_max_open_zones=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seqwrite: (g=0): rw=write, bs=(R) 64.0KiB-64.0KiB, (W) 64.0KiB-64.0KiB, (T) 64.0KiB-64.0KiB, ioengine=psync, iodepth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fio-3.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting 14 processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jobs: 14 (f=14): [W(14)][52.1%][w=2016MiB/s][w=32.3k IOPS][eta 00m:58s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seqwrite: (groupid=0, jobs=14): err= 0: pid=3106632: Mon Jun 27 17:36:58 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=30.3k, BW=1894MiB/s (1986MB/s)(118GiB/63700msec); 0 zone resets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=48, max=39010, avg=459.24, stdev=300.70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=48, max=39010, avg=459.94, stdev=300.70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[   74],  5.00th=[  105], 10.00th=[  141], 20.00th=[  217],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[  289], 40.00th=[  363], 50.00th=[  437], 60.00th=[  506],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[  578], 80.00th=[  660], 90.00th=[  775], 95.00th=[  889],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 1221], 99.50th=[ 1401], 99.90th=[ 2212], 99.95th=[ 2606],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[ 8848]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bw (  MiB/s): min= 1402, max= 2099, per=100.00%, avg=1898.84, stdev=14.55, samples=1769</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=22440, max=33592, avg=30381.38, stdev=232.73, samples=1769</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 50=0.01%, 100=4.32%, 250=20.21%, 500=34.56%, 750=29.17%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 1000=8.92%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=2.67%, 4=0.12%, 10=0.01%, 20=0.01%, 50=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.73%, sys=1.82%, ctx=1930132, majf=0, minf=207</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,1929984,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=1894MiB/s (1986MB/s), 1894MiB/s-1894MiB/s (1986MB/s-1986MB/s), io=118GiB (126GB), run=63700-63700msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nvme5n1: ios=338/1929371, merge=0/0, ticks=47/870253, in_queue=870301, util=99.89%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parameters <em>bs</em> and <em>numjobs</em> can be variated to benchmark different
workload patterns.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="random-and-sequential-reads">Random and sequential reads<a class="hash-link" href="#random-and-sequential-reads" title="Direct link to heading">​</a></h2><p>Assuming that the drive to be benchmarked has <code>max_open_zones=14</code> and more than
140 zones (<code>= offset_increment * max(numjobs)</code>), the drive must be prepared with
data to read of the device, like the example shows.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If the drive is not prepared for the read workload&#x27;s address range, <em>fio</em>
reports wrong performance numbers.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="write-prepare">Write prepare<a class="hash-link" href="#write-prepare" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># fio --ioengine=psync --direct=1 --filename=/dev/nvmeXnX --rw=write --bs=128k \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --group_reporting --zonemode=zbd --name=writeprepare \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --offset_increment=10z --size=10z --numjobs=14 --job_max_open_zones=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">writeprepare: (g=0): rw=write, bs=(R) 128KiB-128KiB, (W) 128KiB-128KiB, (T) 128KiB-128KiB, ioengine=psync, iodepth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fio-3.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting 14 processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jobs: 14 (f=14): [W(14)][52.2%][w=1989MiB/s][w=15.9k IOPS][eta 01m:15s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">writeprepare: (groupid=0, jobs=14): err= 0: pid=3106687: Mon Jun 27 17:38:25 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=14.6k, BW=1831MiB/s (1920MB/s)(147GiB/82360msec); 0 zone resets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=76, max=59281, avg=952.30, stdev=554.79</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=77, max=59282, avg=953.70, stdev=554.80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[  143],  5.00th=[  221], 10.00th=[  306], 20.00th=[  461],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[  611], 40.00th=[  766], 50.00th=[  914], 60.00th=[ 1057],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 1205], 80.00th=[ 1385], 90.00th=[ 1614], 95.00th=[ 1827],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 2343], 99.50th=[ 2638], 99.90th=[ 3720], 99.95th=[ 4228],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[13173]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bw (  MiB/s): min= 1376, max= 2077, per=100.00%, avg=1831.70, stdev=12.39, samples=2296</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=11008, max=16622, avg=14653.59, stdev=99.13, samples=2296</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 100=0.05%, 250=6.70%, 500=15.75%, 750=16.64%, 1000=16.83%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=41.23%, 4=2.74%, 10=0.05%, 20=0.02%, 50=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 100=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.51%, sys=1.03%, ctx=1206314, majf=0, minf=176</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,1206240,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=1831MiB/s (1920MB/s), 1831MiB/s-1831MiB/s (1920MB/s-1920MB/s), io=147GiB (158GB), run=82360-82360msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nvme5n1: ios=48/1202694, merge=0/0, ticks=8/1134109, in_queue=1134117, util=99.92%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sequential-read">Sequential read<a class="hash-link" href="#sequential-read" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># fio --ioengine=psync --direct=1 --filename=/dev/nvmeXnX --rw=read \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --offset_increment=4z --size=4z --group_reporting --zonemode=zbd \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --bs=128k --name=seqread --numjobs=32 --time_based=1 --runtime=10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seqread: (g=0): rw=read, bs=(R) 128KiB-128KiB, (W) 128KiB-128KiB, (T) 128KiB-128KiB, ioengine=psync, iodepth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fio-3.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting 32 processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jobs: 32 (f=32): [R(32)][100.0%][r=3005MiB/s][r=24.0k IOPS][eta 00m:00s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">seqread: (groupid=0, jobs=32): err= 0: pid=3112621: Mon Jun 27 17:38:36 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=23.9k, BW=2992MiB/s (3138MB/s)(29.2GiB/10003msec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=364, max=10454, avg=1335.16, stdev=750.14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=364, max=10454, avg=1335.31, stdev=750.14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[  502],  5.00th=[  594], 10.00th=[  668], 20.00th=[  775],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[  889], 40.00th=[ 1004], 50.00th=[ 1123], 60.00th=[ 1270],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 1467], 80.00th=[ 1762], 90.00th=[ 2278], 95.00th=[ 2802],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 4113], 99.50th=[ 4752], 99.90th=[ 6194], 99.95th=[ 6849],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[ 8291]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bw (  MiB/s): min= 2809, max= 3168, per=100.00%, avg=2994.44, stdev= 2.84, samples=608</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=22479, max=25343, avg=23954.79, stdev=22.68, samples=608</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 500=0.94%, 750=16.55%, 1000=22.41%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=45.83%, 4=13.16%, 10=1.12%, 20=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=0.20%, sys=0.87%, ctx=239539, majf=0, minf=1493</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=239452,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=2992MiB/s (3138MB/s), 2992MiB/s-2992MiB/s (3138MB/s-3138MB/s), io=29.2GiB (31.4GB), run=10003-10003msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nvme5n1: ios=235947/0, merge=0/0, ticks=312373/0, in_queue=312373, util=98.94%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parameters <em>bs</em> and <em>numjobs</em> can be variated to benchmark different
workload patterns. On read workloads the parameter <em>numjobs</em> may exceed the
<em>max_open_zones</em> limit since a zone does not need to be opened for reads.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="random-read">Random read<a class="hash-link" href="#random-read" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># fio --ioengine=io_uring --direct=1 --filename=/dev/nvmeXnX --rw=randread \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --size=128z --zonemode=zbd --bs=128k --name=randread --iodepth=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">randread: (g=0): rw=randread, bs=(R) 128KiB-128KiB, (W) 128KiB-128KiB, (T) 128KiB-128KiB, ioengine=io_uring, iodepth=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fio-3.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting 1 process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jobs: 1 (f=1): [r(1)][100.0%][r=2986MiB/s][r=23.9k IOPS][eta 00m:00s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">randread: (groupid=0, jobs=1): err= 0: pid=3112688: Mon Jun 27 17:40:03 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=24.0k, BW=2997MiB/s (3143MB/s)(256GiB/87459msec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    slat (usec): min=5, max=484, avg= 8.21, stdev= 1.50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=334, max=15331, avg=1325.34, stdev=779.62</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=341, max=15339, avg=1333.69, stdev=779.61</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[  486],  5.00th=[  578], 10.00th=[  652], 20.00th=[  766],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[  873], 40.00th=[  988], 50.00th=[ 1106], 60.00th=[ 1254],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[ 1450], 80.00th=[ 1729], 90.00th=[ 2245], 95.00th=[ 2802],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 4293], 99.50th=[ 5014], 99.90th=[ 6783], 99.95th=[ 7504],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[ 9503]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bw (  MiB/s): min= 2950, max= 3028, per=100.00%, avg=2999.17, stdev=12.81, samples=174</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=23600, max=24224, avg=23993.36, stdev=102.51, samples=174</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 500=1.36%, 750=17.40%, 1000=22.59%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=44.71%, 4=12.62%, 10=1.32%, 20=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=3.43%, sys=24.06%, ctx=1522042, majf=0, minf=1035</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=2097152,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=2997MiB/s (3143MB/s), 2997MiB/s-2997MiB/s (3143MB/s-3143MB/s), io=256GiB (275GB), run=87459-87459msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nvme5n1: ios=2095001/0, merge=0/0, ticks=2778262/0, in_queue=2778262, util=99.95%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parameters <em>bs</em> and <code>iodepth</code> can be variated to benchmark different
workload patterns.</p><p>More ZNS benchmarking examples and scripts can be found in the
<a href="https://github.com/westerndigitalcorporation/zbdbench" target="_blank" rel="noopener noreferrer">ZBDBench</a> repository.
After satisfying the prerequisites of ZBDBench, the benchmarks above are
executed when calling:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># python3 ./run.py -d /dev/nvmeXnX -b fio_zone_throughput_avg_lat --none-scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="read-random-while-writing-sequentially">Read random while writing sequentially<a class="hash-link" href="#read-random-while-writing-sequentially" title="Direct link to heading">​</a></h2><p>The following job file shows an example for a mixed workload with 30% of writes
and 70% of reads. It expects the first 32 zones to be prepared (see <a href="#write-prepare">Write
prepare</a>) as the reads are issued in this range.
The writer is offset by 256 zones, thus the drive to be benchmarked needs to have
then 264 zones  (<code>= write_offset + write_size</code>).</p><p><code>zbd-read-while-write.fio</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[global]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bs=32k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">direct=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zonemode=zbd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=readwhilewriting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time_based</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numjobs=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[write]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ioengine=psync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rw=write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iodepth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offset=256z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offset_increment=8z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size=8z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flow=-3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[randread]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ioengine=io_uring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rw=randread</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iodepth=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size=32z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">offset=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flow=7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># fio --filename=/dev/nvmeXnX &lt;path_to&gt;/zbd-read-while-write.fio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write: (g=0): rw=write, bs=(R) 32.0KiB-32.0KiB, (W) 32.0KiB-32.0KiB, (T) 32.0KiB-32.0KiB, ioengine=psync, iodepth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">randread: (g=0): rw=randread, bs=(R) 32.0KiB-32.0KiB, (W) 32.0KiB-32.0KiB, (T) 32.0KiB-32.0KiB, ioengine=io_uring, iodepth=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fio-3.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting 2 processes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Jobs: 2 (f=2): [W(1),r(1)][100.0%][r=2298MiB/s,w=649MiB/s][r=73.5k,w=20.8k IOPS][eta 00m:00s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write: (groupid=0, jobs=1): err= 0: pid=3112730: Mon Jun 27 17:40:34 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  write: IOPS=20.8k, BW=649MiB/s (680MB/s)(19.0GiB/30001msec); 11 zone resets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=33, max=1683, avg=47.09, stdev= 9.93</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=33, max=1683, avg=47.29, stdev= 9.93</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[   36],  5.00th=[   37], 10.00th=[   38], 20.00th=[   40],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[   42], 40.00th=[   43], 50.00th=[   45], 60.00th=[   48],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[   50], 80.00th=[   53], 90.00th=[   59], 95.00th=[   65],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[   82], 99.50th=[   90], 99.90th=[  106], 99.95th=[  115],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[  135]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bw (  KiB/s): min=643328, max=675904, per=100.00%, avg=664946.98, stdev=7630.42, samples=59</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=20104, max=21122, avg=20779.59, stdev=238.47, samples=59</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 50=70.82%, 100=29.00%, 250=0.18%, 500=0.01%, 750=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 1000=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=4.05%, sys=9.33%, ctx=622712, majf=0, minf=16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=100.0%, 2=0.0%, 4=0.0%, 8=0.0%, 16=0.0%, 32=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=0,622686,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">randread: (groupid=0, jobs=1): err= 0: pid=3112731: Mon Jun 27 17:40:34 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  read: IOPS=72.1k, BW=2253MiB/s (2362MB/s)(66.0GiB/30001msec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    slat (nsec): min=2726, max=97205, avg=5255.51, stdev=2232.08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat (usec): min=119, max=4994, avg=437.72, stdev=227.73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     lat (usec): min=130, max=5000, avg=443.08, stdev=227.72</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clat percentiles (usec):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |  1.00th=[  186],  5.00th=[  206], 10.00th=[  225], 20.00th=[  262],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 30.00th=[  297], 40.00th=[  334], 50.00th=[  379], 60.00th=[  424],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 70.00th=[  486], 80.00th=[  570], 90.00th=[  725], 95.00th=[  881],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.00th=[ 1270], 99.50th=[ 1434], 99.90th=[ 1795], 99.95th=[ 1975],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     | 99.99th=[ 2343]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   bw (  MiB/s): min= 2167, max= 2331, per=100.00%, avg=2252.80, stdev=49.04, samples=59</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   iops        : min=69358, max=74616, avg=72089.53, stdev=1569.23, samples=59</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (usec)   : 250=16.97%, 500=54.94%, 750=19.13%, 1000=5.90%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  lat (msec)   : 2=3.01%, 4=0.04%, 10=0.01%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu          : usr=10.51%, sys=44.28%, ctx=947024, majf=0, minf=270</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=100.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.1%, 64=0.0%, &gt;=64=0.0%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     issued rwts: total=2162550,0,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     latency   : target=0, window=0, percentile=100.00%, depth=32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run status group 0 (all jobs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   READ: bw=2253MiB/s (2362MB/s), 2253MiB/s-2253MiB/s (2362MB/s-2362MB/s), io=66.0GiB (70.9GB), run=30001-30001msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  WRITE: bw=649MiB/s (680MB/s), 649MiB/s-649MiB/s (680MB/s-680MB/s), io=19.0GiB (20.4GB), run=30001-30001msec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk stats (read/write):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nvme5n1: ios=2152981/620234, merge=0/0, ticks=934882/26574, in_queue=961456, util=99.74%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parameters <em>bs</em>, <em>flow</em> and <em>numjobs</em> can be variated to benchmark different
workload patterns.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/benchmarking/fio/smr-fio"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Examples for SMR hard-disks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/benchmarking/rocksdb"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RocksDB - ZenFS</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#sequential-writes" class="table-of-contents__link toc-highlight">Sequential writes</a></li><li><a href="#random-and-sequential-reads" class="table-of-contents__link toc-highlight">Random and sequential reads</a><ul><li><a href="#write-prepare" class="table-of-contents__link toc-highlight">Write prepare</a></li><li><a href="#sequential-read" class="table-of-contents__link toc-highlight">Sequential read</a></li><li><a href="#random-read" class="table-of-contents__link toc-highlight">Random read</a></li></ul></li><li><a href="#read-random-while-writing-sequentially" class="table-of-contents__link toc-highlight">Read random while writing sequentially</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started with Zoned Storage</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/zonedstorage/shared_invite/zt-uyfut5xe-nKajp9YRnEWqiD4X6RkTFw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://webchat.oftc.net/?channels=zonedstorage" target="_blank" rel="noopener noreferrer" class="footer__link-item">IRC @ OFTC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.acbffe4f.js"></script>
<script src="/assets/js/main.f78c3487.js"></script>
</body>
</html>