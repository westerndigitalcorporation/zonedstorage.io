<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools/qemu" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">QEMU and KVM | Zoned Storage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zonedstorage.io/docs/tools/qemu"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="QEMU and KVM | Zoned Storage"><meta data-rh="true" name="description" content="QEMU is a generic machine"><meta data-rh="true" property="og:description" content="QEMU is a generic machine"><link data-rh="true" rel="icon" href="/img/zs-logo.ico"><link data-rh="true" rel="canonical" href="https://zonedstorage.io/docs/tools/qemu"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/tools/qemu" hreflang="en"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/tools/qemu" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><link rel="stylesheet" href="/assets/css/styles.5cd6be9b.css">
<script src="/assets/js/runtime~main.a43c05e2.js" defer="defer"></script>
<script src="/assets/js/main.5c9ead0e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Zoned Storage</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/introduction">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/getting-started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/filesystems">File Systems</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/applications">Applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tools">Tools and Libraries</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/util-linux">Linux System Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/zns">ZNS Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/sg3utils">SCSI Generic Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/libzbc">libzbc User Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/libzbd">libzbd User Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/libnvme">libnvme User Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tools/qemu">QEMU and KVM</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/linux">Linux Kernel Support</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tests">System Compliance Tests</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/benchmarking">Performance Benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/distributions/overview">Linux Distributions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tools and Libraries</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">QEMU and KVM</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>QEMU and KVM</h1>
<p><em><a href="https://www.qemu.org/" target="_blank">QEMU</a></em> is a generic machine
emulator and virtualizer. <em>QEMU</em> provides the userspace components of the
widely used <a href="https://www.linux-kvm.org/" target="_blank"><em>KVM</em>
(Kernel-based Virtual Machine)</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="qemu-and-zoned-block-devices">QEMU and zoned block devices<a href="#qemu-and-zoned-block-devices" class="hash-link" aria-label="Direct link to QEMU and zoned block devices" title="Direct link to QEMU and zoned block devices">​</a></h2>
<p>Host-managed SMR disks can be attached directly to a <em>QEMU</em> guest and used for
running applications in a virtual machine environment. This is useful for
software and kernel development and tests.</p>
<p>There are two supported methods for attaching host-managed SMR zoned disks to a
QEMU guest: (1) <a href="/docs/tools/qemu#qemu-virtio-scsi">virtio-scsi</a> and (2)
<a href="/docs/tools/qemu#qemu-vhost-scsi">vhost-scsi</a>.  <em>virtio-scsi</em> is the simpler
of the two methods. <em>vhost-scsi</em> is the faster of the two methods, but cannot
be used without QEMU KVM acceleration.</p>
<p><em>QEMU</em> also makes it possible to emulate NVMe devices that implement zoned
namespaces.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="qemu-virtio-scsi"><em>QEMU virtio-scsi</em><a href="#qemu-virtio-scsi" class="hash-link" aria-label="Direct link to qemu-virtio-scsi" title="Direct link to qemu-virtio-scsi">​</a></h2>
<p>This is the simplest method for attaching a zoned block device so that it can
be accessed by a QEMU guest. Define a virtual PCI bus and SCSI host and then
use the QEMU option <em>virtio-scsi-pci</em>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="qemu-command-example">QEMU Command Example<a href="#qemu-command-example" class="hash-link" aria-label="Direct link to QEMU Command Example" title="Direct link to QEMU Command Example">​</a></h3>
<p>For example, the following command runs QEMU:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># qemu-kvm (your options) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-device pcie-root-port,bus=pcie.0,id=rp1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-device virtio-scsi-pci,bus=pcie.0,id=scsi0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-drive file=/dev/sdf,format=raw,if=none,id=zbc0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-device scsi-block,bus=scsi0.0,drive=zbc0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-of-qemu-command">Analysis of QEMU Command<a href="#analysis-of-qemu-command" class="hash-link" aria-label="Direct link to Analysis of QEMU Command" title="Direct link to Analysis of QEMU Command">​</a></h4>
<p>The first line, <code>-device pcie-root-port,bus=pcie.0,id=rp1</code>, creates a PCIe root
complex.</p>
<p>The second line, <code>-device virtio-scsi-pci,bus=pcie.0,id=scsi0</code>,
defines a virtio adapter that connects to the previously-defined PCIe bus.</p>
<p>The last 2 lines, <code>-drive file=/dev/sdf,format=raw,if=none,id=zbc0</code>
and <code>-device scsi-block,bus=scsi0.0,drive=zbc0</code>, define the device that is
connected to the virtio SCSI adapter. In this example, <code>-device scsi-block</code> is
used, which means that the host device that will be attached is specified with
the device block device file (<code>/dev/sdf</code>).</p>
<p>See <a href="https://github.com/qemu/qemu/blob/master/docs/pcie_pci_bridge.txt" target="_blank">here</a> for a detailed description of these options.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sense-data-in-qemu-prior-to-version-41">Sense data in QEMU prior to Version 4.1<a href="#sense-data-in-qemu-prior-to-version-41" class="hash-link" aria-label="Direct link to Sense data in QEMU prior to Version 4.1" title="Direct link to Sense data in QEMU prior to Version 4.1">​</a></h3>
<p>Although this method makes it possible to attach a zoned block disk to a QEMU
guest, SCSI command sense data is not processed correctly in older QEMU
versions (this includes all QEMU versions prior to version 4.1). This causes
the guest operating system to hang if the guest attempts to access command
sense data (for example, after command failures). Because of older QEMU
versions&#x27; inability to properly process SCSI command sense data, you should
avoid this attachment method with versions of QEMU older than version 4.1.</p>
<p>The &quot;sense data problem&quot; can be avoided with QEMU versions prior to version
4.1 by attaching a zoned disk to a guest using the &quot;device SG node file&quot; as
a specifier. If you do this, you must use the option <code>-device scsi-generic</code>.
To do this, change the command on the command line in the following way:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># qemu-kvm (your options) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-device pcie-root-port,bus=pcie.0,id=rp1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-device virtio-scsi-pci,bus=pcie.0,id=scsi0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-drive file=/dev/sg5,format=raw,if=none,id=zbc0 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	-device scsi-generic,bus=scsi0.0,drive=zbc0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>On the host, the correspondance between a block device file and its SG node file
can be discovered using the <code>lsscsi</code> command.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[10:0:1:0]   zbc     HGST     HSH721415AL42M0  a250  /dev/sdf   /dev/sg5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After the guest operating system has been started, attachment of the host
device can be checked with any of the methods shown in <a href="/docs/getting-started/smr-disk">the SMR disk section of
the Getting Started Guide</a>.  For example, the
output of the <code>lsscsi</code> command will be as follows with the above example setup.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0:0:0:0]    disk    ATA      QEMU HARDDISK    2.5+  /dev/sda   /dev/sg0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[6:0:1:0]    zbc     HGST     HSH721415AL42M0  a250  /dev/sdb   /dev/sg1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="qemu-vhost-scsi"><em>QEMU vhost-scsi</em><a href="#qemu-vhost-scsi" class="hash-link" aria-label="Direct link to qemu-vhost-scsi" title="Direct link to qemu-vhost-scsi">​</a></h2>
<p>This attachment method uses a fabric module in the host kernel to provide KVM
guests with a fast virtio-based connection to SCSI LUNs. This method cannot be
used without QEMU KVM acceleration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-the-host-vhost-target-module">Enabling the host vhost target module<a href="#enabling-the-host-vhost-target-module" class="hash-link" aria-label="Direct link to Enabling the host vhost target module" title="Direct link to Enabling the host vhost target module">​</a></h3>
<p>The host kernel configuration must have the <em>CONFIG_VHOST_SCSI</em> option enabled.
This option is found in the top level <em>Virtualization</em> menu of the kernel
configuration.</p>
<div class="container text--center"><figure><img src="/assets/images/linux-config-vhost-21cc5561b882aa8097fb30aa35664908.png" width="640" max-width="100%"><figcaption><em>vhost-scsi support option with make menuconfig</em></figcaption></figure></div>
<p>To make it possible to attach physical disks as well as
<a href="/docs/tools/tcmu-runner"><em>tcmu-runner</em></a>-emulated ZBC disks, you must enable
the kernel configuration option <em>COFNGI_TCM_PSCSI</em>. This option can be found in
the menu <em>Device Drivers</em> -&gt; <em>Generic Target Core Mod (TCM) and ConfigFS
Infrastructure</em>.</p>
<div class="container text--center"><figure><img src="/assets/images/linux-config-pscsi-e7c9db15cc4aebcf65fb21db3521a144.png" width="640" max-width="100%"><figcaption><em>pSCSI TCM support option with make menuconfig</em></figcaption></figure></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attaching-a-host-physical-disk">Attaching a host physical disk<a href="#attaching-a-host-physical-disk" class="hash-link" aria-label="Direct link to Attaching a host physical disk" title="Direct link to Attaching a host physical disk">​</a></h3>
<p>To attach a zoned device to a virtual machine guest, you must first prepare a
virtual TCM SAS adapter, using the <em>targetcli</em> tool. Specify the device to
attach by using a block device file. The example below illustrates this
operation for the disk <code>/dev/sdf</code>:</p>
<ol>
<li>
<p><strong>Use the targetcli Tool to Create a Device</strong></p>
<p>Use <em>targetcli</em> to create the device that you will attach.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># targetcli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targetcli shell version 2.1.fb49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright 2011-2013 by Datera, Inc and others.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For help on commands, type &#x27;help&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt; cd backstores/pscsi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/backstores/pscsi&gt; create name=disk1 dev=/dev/sdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Note: block backstore recommended for SCSI block devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created pscsi storage object disk1 using /dev/sdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/backstores/pscsi&gt; cd /vhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost&gt; create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created target naa.5001405a160fe2e1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created TPG 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost/naa.5001405a160fe2e1&gt; cd /vhost/naa.5001405a160fe2e1/tpg1/luns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost/naa.50...2e1/tpg1/luns&gt; create /backstores/pscsi/disk1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created LUN 0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost/naa.50...2e1/tpg1/luns&gt; cd /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt; ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">o- / ..................................................................... [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- backstores .......................................................... [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- block .............................................. [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- fileio ............................................. [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- pscsi .............................................. [Storage Objects: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | | o- disk1 ............................................ [/dev/sdf activated]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | |   o- alua ............................................... [ALUA Groups: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- ramdisk ............................................ [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- user:fbo ........................................... [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- user:rbd ........................................... [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- user:zbc ........................................... [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- iscsi ........................................................ [Targets: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- loopback ..................................................... [Targets: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- vhost ........................................................ [Targets: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- naa.5001405a160fe2e1 ............................................ [TPGs: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      o- tpg1 .............................. [naa.500140565cd16730, no-gen-acls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o- acls ...................................................... [ACLs: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o- luns ...................................................... [LUNs: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          o- lun0 .............................. [pscsi/disk1 (/dev/sdf) (None)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt; exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Use qemu-kvm to Attach the Device</strong></p>
<p>The World-Wide port name assigned by <em>targetcli</em> can then be used to specify
the device to attach, using a qemu-kvm command on the command line:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># qemu-kvm (your options) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       -device pcie-root-port,bus=pcie.0,id=rp1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       -device vhost-scsi-pci,wwpn=naa.5001405a160fe2e1,bus=pcie.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Confirm that the disk is visible to the Virtual Machine Guest OS</strong></p>
<p>List the attached disk from the guest OS by using the <em>lsscsi</em> command:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0:0:0:0]    disk    ATA      QEMU HARDDISK    2.5+  /dev/sda   /dev/sg0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[6:0:1:0]    zbc     HGST     HSH721415AL42M0  a250  /dev/sdb   /dev/sg1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attaching-an-emulated-zbc-disk">Attaching an emulated ZBC disk<a href="#attaching-an-emulated-zbc-disk" class="hash-link" aria-label="Direct link to Attaching an emulated ZBC disk" title="Direct link to Attaching an emulated ZBC disk">​</a></h3>
<p><em>tcmu-runner</em> can be used to create emulated ZBC host-managed SCSI disks. The
emulated disk that is created can be used locally on the host using the
loopback fabric adapter, as explained in the <a href="/docs/tools/tcmu-runner#creating-an-emulated-disk">&quot;Creating an Emulated Disk&quot;
section of the tcmu-runner page</a>.</p>
<p>The emulated ZBC disk can be attached to a vhost virtual adapter for use within
a KVM guest operating system. This is done in a manner similar to the manner in
which a physical device is attached. (See <a href="/docs/tools/qemu#attaching-a-host-physical-disk">&quot;Attaching a Host Physical
Disk&quot;</a> for the particulars of
attaching a physical device).</p>
<p>The following example illustrates this procedure, creating a small 20GB
host-managed SCSI disk with 256 MB zones including 10 conventional zones:</p>
<ol>
<li>
<p><strong>Use targetcli to Create a 20GB Host-managed SCSI Disk</strong></p>
<p>Run the following command to create a 20GB host-managed SCSI disk with
256 MB zones (including 10 conventional zones):</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># targetcli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targetcli shell version 2.1.fb49</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright 2011-2013 by Datera, Inc and others.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For help on commands, type &#x27;help&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt; cd /backstores/user:zbc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/backstores/user:zbc&gt; create name=zbc0 size=20G cfgstring=model-HM/zsize-256/conv-10@/var/local/zbc0.raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created user-backed storage object zbc0 size 21474836480.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/backstores/user:zbc&gt; cd /vhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost&gt; create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created target naa.5001405a0776dce3.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created TPG 1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost&gt; /vhost/naa.5001405a0776dce3/tpg1/luns create /backstores/user:zbc/zbc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created LUN 0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/vhost&gt; cd /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt; ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">o- / ..................................................................... [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- backstores .......................................................... [...]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- block .............................................. [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- fileio ............................................. [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- pscsi .............................................. [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- ramdisk ............................................ [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- user:fbo ........................................... [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- user:rbd ........................................... [Storage Objects: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- user:zbc ........................................... [Storage Objects: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | o- zbc0 [model-HM/zsize-256/conv-10@/var/local/zbc0.raw (20.0GiB) activated]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |     o- alua ............................................... [ALUA Groups: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |       o- default_tg_pt_gp ................... [ALUA state: Active/optimized]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- iscsi ........................................................ [Targets: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- loopback ..................................................... [Targets: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- v  host ...................................................... [Targets: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  o- naa.5001405a0776dce3 ............................................ [TPGs: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     o- tpg1 ............................... [naa.500140533e375d94, no-gen-acls]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o- acls ...................................................... [ACLs: 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        o- luns ...................................................... [LUNs: 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          o- lun0 ............................... [user/zbc0 (default_tg_pt_gp)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/&gt; exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Start the Virtual Machine with qemu-kvm</strong></p>
<p>Start the virtual machine with the emulated ZBC disk attached by using the
World-Wide port name that was assigned by <em>targetcli</em>:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># qemu-kvm (your options) \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       -device pcie-root-port,bus=pcie.0,id=rp1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       -device vhost-scsi-pci,wwpn=naa.5001405a0776dce3,bus=pcie.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Confirm That the Disk is Visible to the Virtual Machine Guest OS</strong></p>
<p>List the disk on the command line of the guest by using <em>lsscsi</em>:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># lsscsi -g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0:0:0:0]    disk    ATA      QEMU HARDDISK    2.5+  /dev/sda   /dev/sg0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[6:0:1:0]    zbc     LIO-ORG  TCMU ZBC device  0002  /dev/sdb   /dev/sg1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="qemu-nvme-zns-device-emulation"><em>QEMU</em> NVMe ZNS Device emulation<a href="#qemu-nvme-zns-device-emulation" class="hash-link" aria-label="Direct link to qemu-nvme-zns-device-emulation" title="Direct link to qemu-nvme-zns-device-emulation">​</a></h2>
<p><a href="/docs/getting-started/zbd-emulation#nvme-zoned-namespace-device-emulation-with-qemu">This article</a>
describes in detail how <em>QEMU</em> can be configured to create an emulated NVMe ZNS
namespace that is visible to the guest operating system. Example commands and an
example shell script are provided as references.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tools/tcmu-runner"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">tcmu-runner ZBC Disk Emulation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/linux"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#qemu-and-zoned-block-devices" class="table-of-contents__link toc-highlight">QEMU and zoned block devices</a></li><li><a href="#qemu-virtio-scsi" class="table-of-contents__link toc-highlight"><em>QEMU virtio-scsi</em></a><ul><li><a href="#qemu-command-example" class="table-of-contents__link toc-highlight">QEMU Command Example</a></li><li><a href="#sense-data-in-qemu-prior-to-version-41" class="table-of-contents__link toc-highlight">Sense data in QEMU prior to Version 4.1</a></li></ul></li><li><a href="#qemu-vhost-scsi" class="table-of-contents__link toc-highlight"><em>QEMU vhost-scsi</em></a><ul><li><a href="#enabling-the-host-vhost-target-module" class="table-of-contents__link toc-highlight">Enabling the host vhost target module</a></li><li><a href="#attaching-a-host-physical-disk" class="table-of-contents__link toc-highlight">Attaching a host physical disk</a></li><li><a href="#attaching-an-emulated-zbc-disk" class="table-of-contents__link toc-highlight">Attaching an emulated ZBC disk</a></li></ul></li><li><a href="#qemu-nvme-zns-device-emulation" class="table-of-contents__link toc-highlight"><em>QEMU</em> NVMe ZNS Device emulation</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started with Zoned Storage</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/zonedstorage/shared_invite/zt-uyfut5xe-nKajp9YRnEWqiD4X6RkTFw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://webchat.oftc.net/?channels=zonedstorage" target="_blank" rel="noopener noreferrer" class="footer__link-item">IRC @ OFTC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
</body>
</html>