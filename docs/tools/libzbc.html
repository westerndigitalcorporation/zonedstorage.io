<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools/libzbc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">libzbc User Library | Zoned Storage</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://zonedstorage.io/docs/tools/libzbc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="libzbc User Library | Zoned Storage"><meta data-rh="true" name="description" content="libzbc is a user library that provides functions for manipulating ZBC and ZAC"><meta data-rh="true" property="og:description" content="libzbc is a user library that provides functions for manipulating ZBC and ZAC"><link data-rh="true" rel="icon" href="/img/zs-logo.ico"><link data-rh="true" rel="canonical" href="https://zonedstorage.io/docs/tools/libzbc"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/tools/libzbc" hreflang="en"><link data-rh="true" rel="alternate" href="https://zonedstorage.io/docs/tools/libzbc" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"libzbc User Library","item":"https://zonedstorage.io/docs/tools/libzbc"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0DX1KGD5E4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0DX1KGD5E4",{})</script><link rel="stylesheet" href="/assets/css/styles.0fff285b.css">
<script src="/assets/js/runtime~main.92571c25.js" defer="defer"></script>
<script src="/assets/js/main.69b7e4e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/zs-logo.png" alt="Zoned Storage Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Zoned Storage</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/docs/community/support">Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/westerndigitalcorporation/zonedstorage.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/introduction">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/getting-started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/linux">Linux Kernel Support</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/device-mapper">Device Mapper</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/filesystems">File Systems</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/applications">Applications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/tools">Tools and Libraries</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/util-linux">Linux System Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/zns">ZNS Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/sg3utils">SCSI Generic Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tools/libzbc">libzbc User Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/libzbd">libzbd User Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/libnvme">libnvme User Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/tcmu-runner">tcmu-runner ZBC Disk Emulation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tools/qemu">QEMU and KVM</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tests">System Compliance Tests</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/benchmarking">Performance Benchmarking</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/distributions/overview">Linux Distributions</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tools and Libraries</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">libzbc User Library</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>libzbc User Library</h1></header>
<p><em>libzbc</em> is a user library that provides functions for manipulating ZBC and ZAC
disks. The command implementation of <em>libzbc</em> is compliant with the latest
published versions of the ZBC and ZAC standards as defined by INCITS technical
committees T10 (for ZBC) and T13 (for ZAC).</p>
<p>In addition to supporting ZBC and ZAC disks, <em>libzbc</em> may implement an emulation
mode that allows the library to imitate the behavior of a host managed zoned
disk, using a regular file or a standard block device as the backing store.</p>
<p>The <em>libzbc</em> project is hosted on <a href="https://github.com/westerndigitalcorporation/libzbc" target="_blank">GitHub</a>.
The project&#x27;s <a href="https://github.com/westerndigitalcorporation/libzbc/blob/master/README.md" target="_blank">
<em>README</em> file</a> provides information on how to compile and install the
<em>libzbc</em> library and its tools.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The <em>libzbc</em> project was formerly hosted on GitHub as part of
the <a href="https://github.com/hgst" target="_blank">HGST organization</a>.
<em>libzbc</em> repository has since then moved to
the <a href="https://github.com/westerndigitalcorporation/" target="_blank">Western Digital Corporation organization on GitHub</a>.</p></div></div>
<p><em>libzbc</em> provides a test suite that makes it possible to test disks and HBAs
for conformity to the ZBC and ZAC standards.  In order to make the test suite
available, <em>libzbc</em> must be configured using the <em>--with-test</em> option prior to
building and installing the library. The usage of this test suite is described
in more detail <a href="/docs/tests/zbc-tests">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p><em>libzbc</em> provides a unified application programming interface (API) that is
independent of the zone model and the interface of the disk being used.
Internally, four different types of device drivers are used to handle commands
that are dependent on the device interface:</p>
<ul>
<li><strong>ZAC ATA Driver</strong> This driver is used to handle the direct delivery of ATA
commands to ZAC disks through the SCSI generic driver (direct device
access interface).</li>
<li><strong>ZBC SCSI Driver</strong> This driver primarily handles SCSI commands directed at
ZBC SCSI disks, but can also be used to control ZAC ATA disks if a functional
SCSI to ATA (SAT) command translation layer exists in the command path.
SAT may be provided either by the kernel <em>libata</em> subsystem for ATA disks
connected to SATA adapters or by an SAS host bus adapter (HBA) for SATA disks
connected to such an adapter.</li>
<li><strong>Zoned Block Device Driver</strong> This driver uses the kernel zoned block devie
interface to control both ZBC and ZAC disks. This driver is only available if
kernel zoned block device support is present and enabled. This driver is no
longer available in <em>libzbc</em> v6.0.0 and upward.</li>
<li><strong>File Emulation Driver</strong> This driver emulates a host managed ZBC disk using
a regular file or regular block device as backend storage. This driver is
intended for development only. A more advanced ZBC disk emulation solution
is provided by the <a href="/docs/tools/tcmu-runner"><em>tcmu-runner</em></a> project. This
driver is no longer available in <em>libzbc</em> v6.0.0.0 and upward.</li>
</ul>
<p>The figure below shows this structure.</p>
<div class="container text--center"><figure><img src="/assets/images/tools-libzbc-9dc574a0bfec08d195e6e4179d6cd272.png" width="640" max-width="100%"><figcaption><em>libzbc v5.0.0 - v6.0.0 internal backend drivers organization</em></figcaption></figure></div>
<p>The latest version of <em>libzbc</em>, version 6.0.0, does not support the
<strong>Zoned Block Device Driver</strong>. This change avoids the overlap in functionality
with <a href="/docs/tools/libzbd"><em>libzbd</em></a>. In practice, it means that <em>libzbc</em> is now a pure
passthrough library which never use the kernel zoned block devie management
interface.</p>
<p><em>libzbc</em> version 6.0.0 also removes the <strong>File Emulation Driver</strong> because
recent versions of QEMU and <a href="/docs/tools/tcmu-runner"><em>tcmu-runner</em></a> provide much more
extensive and flexible means for emulating a ZBC device, making <em>libzbc</em>-based
emulation obsolete.</p>
<p>The figure below illustrates the new <em>libzbc</em> v6.0.0 structure.</p>
<div class="container text--center"><figure><img src="/assets/images/tools-libzbc6-fe08e2556f1b8d60abbddabbf9d580b7.png" width="640" max-width="100%"><figcaption><em>libzbc v6.0.0 upward internal backend drivers organization</em></figcaption></figure></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-model">State model<a href="#state-model" class="hash-link" aria-label="Direct link to State model" title="Direct link to State model">​</a></h2>
<p><em>libzbc</em> provides functions for discovering the zone configuration of a zoned
device and for accessing the device. Accesses to the device may result in
changes to the condition of the device zone, the attributes of the device zone,
and the state of device zone (such as the write pointer&#x27;s location in
sequential zones). These changes are not tracked internally by <em>libzbc</em>. That
is, <em>libzbc</em> is stateless.</p>
<p>The functions that are provided to obtain the device zone information make a
&quot;snapshot&quot; of the zone condition and state only when executed. It is the
responsibility of applications to implement tracking of the device zone changes
(such as the increasing write pointer position of a sequential zone after the
completion of write requests to the zone).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="library-functions">Library Functions<a href="#library-functions" class="hash-link" aria-label="Direct link to Library Functions" title="Direct link to Library Functions">​</a></h2>
<p>All <em>libzbc</em> functions since version 5.0.0 use a 512-byte sector unit for (1)
reporting zone information and (2) as the sector addressing unit for device
accesses, regardless of the actual device logical block size. This unification
in the unit used by all functions can simplify application development by
hiding potential differences in logical block sizes between devices. However,
application programmers must be careful always to implement accesses (read or
write) to the device that are aligned to the device&#x27;s logical block size.
Furthermore, on host managed zoned devices, write operations to sequential
zones must be aligned to the device&#x27;s physical block size.</p>
<p>The main functions provided by <em>libzbc</em> are as follows:</p>
<center><table><thead><tr><th style="text-align:left">Function</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">zbc_open()</td><td style="text-align:left">Open a zoned device</td></tr><tr><td style="text-align:left">zbc_close()</td><td style="text-align:left">Close a zoned device</td></tr><tr><td style="text-align:left">zbc_get_device_info()</td><td style="text-align:left">Get device information</td></tr><tr><td style="text-align:left">zbc_report_nr_zones()</td><td style="text-align:left">Get the number of zones</td></tr><tr><td style="text-align:left">zbc_report_zones()</td><td style="text-align:left">Get zone information</td></tr><tr><td style="text-align:left">zbc_list_zones()</td><td style="text-align:left">Get zone information</td></tr><tr><td style="text-align:left">zbc_zone_operation()</td><td style="text-align:left">Execute a zone operation</td></tr><tr><td style="text-align:left">zbc_open_zone()</td><td style="text-align:left">Explicitly open a zone</td></tr><tr><td style="text-align:left">zbc_close_zone()</td><td style="text-align:left">Close an open zone</td></tr><tr><td style="text-align:left">zbc_finish_zone()</td><td style="text-align:left">Finish a zone</td></tr><tr><td style="text-align:left">zbc_reset_zone()</td><td style="text-align:left">Reset a zone write pointer</td></tr><tr><td style="text-align:left">zbc_pread()</td><td style="text-align:left">Read data from a zone</td></tr><tr><td style="text-align:left">zbc_pwrite()</td><td style="text-align:left">Write data to a zone</td></tr><tr><td style="text-align:left">zbc_flush()</td><td style="text-align:left">Flush data to disk</td></tr></tbody></table></center>
<p>Since the release 6.0.0, additional <em>libzbc</em> API functions are available.
Most of them have been added to support certain new features defined in
ZAC-2/ZBC-2 standard specification.</p>
<p>The two new ZAC-2/ZBC-2 features that <em>libzbc</em> 6.0.0 supports are</p>
<ul>
<li>Zone Domains/Zone Realms protocol that is commonly used to control DH-SMR
(aka XMR) zoned devices</li>
<li>the ability to specify zone counts for zone operations</li>
</ul>
<p>The new API functions that are only available from release 6.0.0 and onward
are listed below.</p>
<center><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td>zbc_zone_group_op()</td><td>Execute a zone operation on a group of zones</td></tr><tr><td>zbc_open_zones()</td><td>Open a group of zones</td></tr><tr><td>zbc_close_zones()</td><td>Close a group of zones</td></tr><tr><td>zbc_finish_zones()</td><td>Finish a group of zones</td></tr><tr><td>zbc_reset_zones()</td><td>Reset a group of zones</td></tr><tr><td>zbc_report_domains()</td><td>Get zone domain information</td></tr><tr><td>zbc_report_realms()</td><td>Get zone realm information</td></tr><tr><td>zbc_report_nr_realms()</td><td>Get the number of realms</td></tr><tr><td>zbc_zone_activate()</td><td>Activate zones at a new zone domain</td></tr><tr><td>zbc_zone_query()</td><td>Query about possible results of zone activation</td></tr><tr><td>zbc_get_nr_actv_records()</td><td>Get the number of activation records</td></tr><tr><td>zbc_zone_activation_ctl()</td><td>Read or change persistent device settings</td></tr></tbody></table></center>
<p>More detailed information about the  usage and behavior of these functions can
be found in the comments of <a href="https://github.com/westerndigitalcorporation/libzbc/blob/master/include/libzbc/zbc.h" target="_blank"><em>libzbc</em> header file</a>. This header file is installed by
default as <code>/usr/include/libzbc/zbc.h</code>.</p>
<p><em>libzbc</em> does not implement any mutual exclusion mechanism for multi-thread or
multi-process applications. This means that it is the responsibility of
applications to synchronize the execution of conflicting operations that target
the same zone. A typical example of such a case is &quot;concurrent write operations
to the same zone by multiple threads&quot;, which can result in write errors if the
application does not have write ordering control.</p>
<p>The following functions are also provided by <em>libzbc</em> to facilitate application
development and tests:</p>
<center><table><thead><tr><th style="text-align:left">Function</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">zbc_set_log_level()</td><td style="text-align:left">Set log level of the library functions</td></tr><tr><td style="text-align:left">zbc_device_is_zoned()</td><td style="text-align:left">Test if a device is a zoned block device</td></tr><tr><td style="text-align:left">zbc_print_device_info()</td><td style="text-align:left">Print to a file (stream) a device information</td></tr><tr><td style="text-align:left">zbc_device_type_str()</td><td style="text-align:left">Get a string description of a device type</td></tr><tr><td style="text-align:left">zbc_device_model_str()</td><td style="text-align:left">Get a string description of a device model</td></tr><tr><td style="text-align:left">zbc_zone_type_str()</td><td style="text-align:left">Get a string description of a zone type</td></tr><tr><td style="text-align:left">zbc_zone_condition_str()</td><td style="text-align:left">Get a string description of a zone condition</td></tr><tr><td style="text-align:left">zbc_errno()</td><td style="text-align:left">Return sense key and sense code of the last command executed</td></tr><tr><td style="text-align:left">zbc_sk_str()</td><td style="text-align:left">Get a string description of a sense key</td></tr><tr><td style="text-align:left">zbc_asc_ascq_str()</td><td style="text-align:left">Get a string description of a sense code</td></tr></tbody></table></center>
<p><em>libzbc</em> 6.0.0 adds one new function to the test and development portion
of the API:</p>
<center><table><thead><tr><th style="text-align:left">Function</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">zbc_version()</td><td style="text-align:left">Return the library version</td></tr></tbody></table></center>
<p>All functions behave in the same manner regardless of the type of disk that is
used. The only exception to this is the <code>zbc_errno()</code> function&#x27;s inability to
report detailed error information when the zoned block device driver is used.
The reason for this is that the kernel I/O stack does not have the ability to
propagate up to the application the detailed information that is provided in
SCSI/ATI sense data for failed commands.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tools">Tools<a href="#tools" class="hash-link" aria-label="Direct link to Tools" title="Direct link to Tools">​</a></h2>
<p><em>libzbc</em> provides several command line applications for manipulating zoned
disks by calling the library functions. The list of applications provided is
shown in the table below:</p>
<center><table><thead><tr><th style="text-align:left">Tool</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">gzbc</td><td style="text-align:left">gzbc provides a graphical user interface showing zone information of a zoned device</td></tr><tr><td style="text-align:left">zbc_info</td><td style="text-align:left">Get information on a disk</td></tr><tr><td style="text-align:left">zbc_report_zones</td><td style="text-align:left">List the zones of a device</td></tr><tr><td style="text-align:left">zbc_reset_zone</td><td style="text-align:left">Reset the write pointer of sequential zones</td></tr><tr><td style="text-align:left">zbc_open_zone</td><td style="text-align:left">Explicitly open a sequential write zone</td></tr><tr><td style="text-align:left">zbc_close_zone</td><td style="text-align:left">Close an open sequential write zone</td></tr><tr><td style="text-align:left">zbc_finish_zone</td><td style="text-align:left">Transition a sequential write zone to the full condition</td></tr><tr><td style="text-align:left">zbc_read_zone</td><td style="text-align:left">Read a zone sectors</td></tr><tr><td style="text-align:left">zbc_write_zone</td><td style="text-align:left">Write a zone sectors</td></tr></tbody></table></center>
<p><em>libzbc</em> release 6.0.0 introduces a few additional tools to facilitate
Zone Domains/Zone Realms support. These tools are:</p>
<center><table><thead><tr><th style="text-align:left">Tool</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">zbc_report_domains</td><td style="text-align:left">Report zone domains</td></tr><tr><td style="text-align:left">zbc_report_realms</td><td style="text-align:left">Report zone realms</td></tr><tr><td style="text-align:left">zbc_zone_activate</td><td style="text-align:left">Activate or query zones at a new zone domain</td></tr><tr><td style="text-align:left">zbc_dev_control</td><td style="text-align:left">Read or change persistent device settings</td></tr></tbody></table></center>
<p>The following tools are provided to create and modify the regular file or
regular block device used as backend storage with <em>libzbc</em> emulation mode.
These tools are no longer available as of v6.0.0.</p>
<center><table><thead><tr><th style="text-align:left">Tool</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left">zbc_set_zones</td><td style="text-align:left">Initialize (format) a regular file or regular disk to be used with <em>libzbc</em> emulation mode</td></tr><tr><td style="text-align:left">zbc_set_write_ptr</td><td style="text-align:left">Change the write pointer position of the sequential zones of an emulated disk (intended for testing purposes only as this is not a valid operation for physical ZBC devices</td></tr></tbody></table></center>
<p>All tools output a help message when executed without any argument:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage: zbc_report_zones [options] &lt;dev&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v		  : Verbose mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -lba		  : Use LBA size unit (default is 512B sectors)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -start &lt;offset&gt; : Start offset of report. if &quot;-lba&quot; is used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &lt;offset&gt; is interpreted as an LBA. Otherwise,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    it is interpreted as a 512B sector number.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Default is 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n		  : Get only the number of zones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -nz &lt;num&gt;	  : Get at most &lt;num&gt; zones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -ro &lt;opt&gt;	  : Specify reporting option: &quot;all&quot;, &quot;empty&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;imp_open&quot;, &quot;exp_open&quot;, &quot;closed&quot;, &quot;full&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;rdonly&quot;, &quot;offline&quot;, &quot;rwp&quot;, &quot;non_seq&quot; or &quot;not_wp&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Default is &quot;all&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-disk-information">Getting Disk Information<a href="#getting-disk-information" class="hash-link" aria-label="Direct link to Getting Disk Information" title="Direct link to Getting Disk Information">​</a></h3>
<p><em>zbc_info</em> displays information about a disk, including regular block devices:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_info /dev/sg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_info /dev/sg0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sg0 is not a zoned block device</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="zone-information">Zone Information<a href="#zone-information" class="hash-link" aria-label="Direct link to Zone Information" title="Direct link to Zone Information">​</a></h3>
<p><em>zbc_report_zones</em> illustrates the use of the <em>libzbc</em> zone reporting functions
<code>zbc_report_zones()</code>, <code>zbc_report_nr_zones()</code> and <code>zbc_list_zones()</code>.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones /dev/sg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    55880 zones from 0, reporting option 0x00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55880 / 55880 zones:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00000: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 0, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00001: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 524288, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00002: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 1048576, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00522: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 273678336, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00523: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 274202624, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00524: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sector 274726912, 524288 sectors, wp 274726912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00525: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sector 275251200, 524288 sectors, wp 275251200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 55878: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 29296164864, 524288 sectors, wp 29296164864</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 55879: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 29296689152, 524288 sectors, wp 29296689152</span><br></span></code></pre></div></div>
<p>The output of <em>zbc_report_zones</em> can be limited by using the option <code>-ro</code>
(reporting options) to filter which zones are reported, or by using the option
<code>-n</code> to limit the output to the number of zones specified as an argument of
this option.</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones -ro not_wp -n /dev/sg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zoned block device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    524 zones from 0, reporting option 0x3f</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-and-resetting-zones">Writing and Resetting Zones<a href="#writing-and-resetting-zones" class="hash-link" aria-label="Direct link to Writing and Resetting Zones" title="Direct link to Writing and Resetting Zones">​</a></h3>
<p><em>zbc_write_zone</em> sequentially writes data to a zone. If the zone is a
sequential zone, the write pointer position advances until the zone is full. By
default, <em>zbc_write_zone</em> writes the entire zone. For example, using the disk
used in the previous example, the first sequential write zone (zone number 524)
can be written with 512 kb writes with the following command, until it is full:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_write_zone /dev/sg3 524 524288</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SCSI ZBC device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Target zone: Zone 524 / 55880, type 0x2 (Sequential-write-required), cond 0x1 (Empty), rwp 0, non_seq 0, sector 274726912, 524288 sectors, wp 274726912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Filling target zone 524, 524288 B I/Os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wrote 268435456 B (512 I/Os) in 1.082 sec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IOPS 472</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BW 247.952 MB/s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones -start 274726912 -nz 1 /dev/sg3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SCSI ZBC device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    55356 zones from 274726912, reporting option 0x00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 / 55356 zone:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00000: type 0x2 (Sequential-write-required), cond 0xe (Full), reset recommended 0, non_seq 0, sector 274726912, 524288 sectors, wp 2251799813685240</span><br></span></code></pre></div></div>
<p>The written zone can then be reset by using the command <em>zbc_reset_zone</em>:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_reset_zone /dev/sg3 524</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg3:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SCSI ZBC device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reset zone 524/55880, sector 274726912...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones -start 274726912 -nz 1 /dev/sg7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg7:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SCSI ZBC device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    55356 zones from 274726912, reporting option 0x00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 / 55356 zone:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00000: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 274726912, 524288 sectors, wp 274726912</span><br></span></code></pre></div></div>
<p>All the sequential write zones of a device can be reset using the option
<code>-all</code>:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_reset_zone -all /dev/sg7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device /dev/sg7:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: ATA HGST HSH721415AL T220</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SCSI ZBC device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    29297213440 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 logical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3662151680 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    15000.173 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are unrestricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Operating on all zones...</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphical-interface">Graphical Interface<a href="#graphical-interface" class="hash-link" aria-label="Direct link to Graphical Interface" title="Direct link to Graphical Interface">​</a></h3>
<p><em>gzbc</em> provides a graphical user interface that shows the zone configuration
and state of a zoned  device. <em>gzbc</em> displays the write status (write pointer
position) of zones by using color coding (red for written sectors and green for
unwritten sectors). Some operations on zones can be executed directly from the
interface (&quot;reset zone write pointer&quot;, &quot;open zone&quot;, &quot;close zone&quot;, etc).</p>
<div class="container text--center"><figure><img src="/assets/images/tools-libzbc-gzbc-5d6b525337b567661f392ef6d06ad83e.png" width="640" max-width="100%"><figcaption><em>gzbc screeshot</em></figcaption></figure></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="emulation-mode">Emulation Mode<a href="#emulation-mode" class="hash-link" aria-label="Direct link to Emulation Mode" title="Direct link to Emulation Mode">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Emulation mode is only available in <em>libzbc</em> prior to v6.0.0.0.</p></div></div>
<p><em>libzbc</em> emulation mode requires a regular file or a regular block device as
backend storage. The size of the file or the capacity of the block device is
used as the emulated device&#x27;s capacity.</p>
<p>For example, the following commands will create a 10GB file name <code>zbc-disk</code>
that can be used as an emulated disk:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># touch zbc-disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># truncate -s 10G zbc-disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ls -l zbc-disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 root root 10737418240 May 22 16:48 zbc-disk</span><br></span></code></pre></div></div>
<p>This file can now be initialized for use with <em>libzbc</em> emulation mode:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_set_zones zbc-disk set_ps 10 256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device zbc-disk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: FAKE HGST HM libzbc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Emulated zoned block device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    20971520 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    20971520 logical blocks of 512 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2621440 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.737 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting zones:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Zone size: 256 MiB (524288 sectors)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Conventional zones: 1024 MiB (2097152 sectors), 10.00 % of total capacity), 4 zones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sequential zones: 36 zones</span><br></span></code></pre></div></div>
<p>The file can now be used with <em>libzbc</em> library functions and tools as though it
is a physical zoned block device:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># zbc_report_zones zbc-disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device zbc-disk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Vendor ID: FAKE HGST HM libzbc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Emulated zoned block device interface, Host-managed zone model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    20971520 512-bytes sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    20971520 logical blocks of 512 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2621440 physical blocks of 4096 B</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.737 GB capacity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Read commands are restricted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Maximum number of open sequential write required zones: 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    40 zones from 0, reporting option 0x00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">40 / 40 zones:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00000: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 0, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00001: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 524288, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00002: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 1048576, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00003: type 0x1 (Conventional), cond 0x0 (Not-write-pointer), sector 1572864, 524288 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00004: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 2097152, 524288 sectors, wp 2097152</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00005: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 2621440, 524288 sectors, wp 2621440</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00038: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 19922944, 524288 sectors, wp 19922944</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Zone 00039: type 0x2 (Sequential-write-required), cond 0x1 (Empty), reset recommended 0, non_seq 0, sector 20447232, 524288 sectors, wp 20447232</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tools/sg3utils"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SCSI Generic Utilities</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tools/libzbd"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">libzbd User Library</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#state-model" class="table-of-contents__link toc-highlight">State model</a></li><li><a href="#library-functions" class="table-of-contents__link toc-highlight">Library Functions</a></li><li><a href="#tools" class="table-of-contents__link toc-highlight">Tools</a><ul><li><a href="#getting-disk-information" class="table-of-contents__link toc-highlight">Getting Disk Information</a></li><li><a href="#zone-information" class="table-of-contents__link toc-highlight">Zone Information</a></li><li><a href="#writing-and-resetting-zones" class="table-of-contents__link toc-highlight">Writing and Resetting Zones</a></li><li><a href="#graphical-interface" class="table-of-contents__link toc-highlight">Graphical Interface</a></li></ul></li><li><a href="#emulation-mode" class="table-of-contents__link toc-highlight">Emulation Mode</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/zoned-storage">Introduction to Zoned Storage</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started with Zoned Storage</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.element.io/#/room/#zonedstorage-general:matrix.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/westerndigitalcorporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organization<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Western Digital
	Corporation or its affiliates. All rights reserved.<br> By using this site, you agree to the <a href="https://www.westerndigital.com/legal/terms-of-use" target="_blank">Terms of Use</a> and <a href="https://www.westerndigital.com/legal/privacy-statement" target="_blank">Privacy Statement</a>.  All example scripts and program snippets on this site are licensed under the <a href="https://creativecommons.org/publicdomain/zero/1.0/" target="_blank">CCO 1.0 Universal</a> license.<br>This site is built with <a href="https://docusaurus.io/" target="_blank">Docusaurus</a>.</div></div></div></footer></div>
</body>
</html>